!function(e,t){"function"==typeof define&&define.amd?define([],t):(e.glympse||(e.glympse={}),e.glympse.journeyCore=t())}(this,function(){function e(){}var t,n,r;return function(e){function i(e,t){return _.call(e,t)}function a(e,t){var n,r,i,a,o,s,u,c,d,l,p,f,m=t&&t.split("/"),g=b.map,h=g&&g["*"]||{};if(e){for(e=e.split("/"),o=e.length-1,b.nodeIdCompat&&E.test(e[o])&&(e[o]=e[o].replace(E,"")),"."===e[0].charAt(0)&&m&&(f=m.slice(0,m.length-1),e=f.concat(e)),d=0;d<e.length;d++)if(p=e[d],"."===p)e.splice(d,1),d-=1;else if(".."===p){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((m||h)&&g){for(n=e.split("/"),d=n.length;d>0;d-=1){if(r=n.slice(0,d).join("/"),m)for(l=m.length;l>0;l-=1)if(i=g[m.slice(0,l).join("/")],i&&(i=i[r])){a=i,s=d;break}if(a)break;!u&&h&&h[r]&&(u=h[r],c=d)}!a&&u&&(a=u,s=c),a&&(n.splice(0,s,a),e=n.join("/"))}return e}function o(t,n){return function(){var r=C.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),m.apply(e,r.concat([t,n]))}}function s(e){return function(t){return a(t,e)}}function u(e){return function(t){v[e]=t}}function c(t){if(i(y,t)){var n=y[t];delete y[t],w[t]=!0,f.apply(e,n)}if(!i(v,t)&&!i(w,t))throw new Error("No "+t);return v[t]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return e?d(e):[]}function p(e){return function(){return b&&b.config&&b.config[e]||{}}}var f,m,g,h,v={},y={},b={},w={},_=Object.prototype.hasOwnProperty,C=[].slice,E=/\.js$/;g=function(e,t){var n,r=d(e),i=r[0],o=t[1];return e=r[1],i&&(i=a(i,o),n=c(i)),i?e=n&&n.normalize?n.normalize(e,s(o)):a(e,o):(e=a(e,o),r=d(e),i=r[0],e=r[1],i&&(n=c(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},h={require:function(e){return o(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:p(e)}}},f=function(t,n,r,a){var s,d,p,f,m,b,_,C=[],E=typeof r;if(a=a||t,b=l(a),"undefined"===E||"function"===E){for(n=!n.length&&r.length?["require","exports","module"]:n,m=0;m<n.length;m+=1)if(f=g(n[m],b),d=f.f,"require"===d)C[m]=h.require(t);else if("exports"===d)C[m]=h.exports(t),_=!0;else if("module"===d)s=C[m]=h.module(t);else if(i(v,d)||i(y,d)||i(w,d))C[m]=c(d);else{if(!f.p)throw new Error(t+" missing "+d);f.p.load(f.n,o(a,!0),u(d),{}),C[m]=v[d]}p=r?r.apply(v[t],C):void 0,t&&(s&&s.exports!==e&&s.exports!==v[t]?v[t]=s.exports:p===e&&_||(v[t]=p))}else t&&(v[t]=r)},t=n=m=function(t,n,r,i,a){if("string"==typeof t)return h[t]?h[t](n):c(g(t,l(n)).f);if(!t.splice){if(b=t,b.deps&&m(b.deps,b.callback),!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},"function"==typeof r&&(r=i,i=a),i?f(e,t,n,r):setTimeout(function(){f(e,t,n,r)},4),m},m.config=function(e){return m(e)},t._defined=v,r=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),i(v,e)||i(y,e)||(y[e]=[e,t,n])},r.amd={jQuery:!0}}(),r("almond",function(){}),e.generate=function(){var t=e._gri,n=e._ha;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)},e._gri=function(e){return 0>e?NaN:30>=e?0|Math.random()*(1<<e):53>=e?(0|1073741824*Math.random())+1073741824*(0|Math.random()*(1<<e-30)):NaN},e._ha=function(e,t){for(var n=e.toString(16),r=t-n.length,i="0";r>0;r>>>=1,i+=i)1&r&&(n=i+n);return n},r("UUID",function(){}),function(e){var t,n,r,i={}.toString;Kamino={},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Kamino),exports.Kamino=Kamino):e.Kamino=Kamino,Kamino.VERSION="0.1.0",KaminoException=function(){this.name="KaminoException",this.number=25,this.message="Uncaught Error: DATA_CLONE_ERR: Kamino Exception 25"};var a=new Date(-0xc782b5b800cec);try{a=-109252==a.getUTCFullYear()&&0===a.getUTCMonth()&&1==a.getUTCDate()&&10==a.getUTCHours()&&37==a.getUTCMinutes()&&6==a.getUTCSeconds()&&708==a.getUTCMilliseconds()}catch(o){}var s="A"!="A"[0];if(!a){Math.floor}(t={}.hasOwnProperty)||(t=function(e){var n,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=i?t=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(n=r.constructor,t=function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),r=null,t.call(this,e)}),n=function(e,n){var r,a,o,s,u=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,a=new r;for(o in a)t.call(a,o)&&u++;return r=a=null,u?s=2==u?function(e,n){var r,a={},o="[object Function]"==i.call(e);for(r in e)o&&"prototype"==r||t.call(a,r)||!(a[r]=1)||!t.call(e,r)||n(r)}:function(e,n){var r,a,o="[object Function]"==i.call(e);for(r in e)o&&"prototype"==r||!t.call(e,r)||(a="constructor"===r)||n(r);(a||t.call(e,r="constructor"))&&n(r)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],s=function(e,n){var r,o,s="[object Function]"==i.call(e);for(r in e)s&&"prototype"==r||!t.call(e,r)||n(r);for(o=a.length;r=a[--o];t.call(e,r)&&n(r));}),s(e,n)};var u={"\\":"\\\\",'"':'\\"',"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},c=function(e,t){return("000000"+(t||0)).slice(-e)},d=function(e){for(var t,n='"',r=0;t=e.charAt(r);r++)n+='\\"\b\f\n\r	'.indexOf(t)>-1?u[t]:u[t]=" ">t?"\\u00"+c(2,t.charCodeAt(0).toString(16)):t;return n+'"'},l=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},p=function(e,a,o,u,c,f,m){var g,h,v,y,b,w,_,C,E,S,I=a[e],A="";if(I instanceof Error||I instanceof Function)throw new KaminoException;if(l(I))throw new KaminoException;if("object"==typeof I&&I&&(g=i.call(I),"[object Date]"!=g||t.call(I,"toJSON")?"function"==typeof I.toJSON&&("[object Number]"!=g&&"[object String]"!=g&&"[object Array]"!=g||t.call(I,"toJSON"))&&(I=I.toJSON(e)):I=I>-1/0&&1/0>I?I.toUTCString().replace("GMT","UTC"):null),o&&(I=o.call(a,e,I)),null===I)return"null";if(void 0!==I){if(h=i.call(I),"[object Boolean]"==h)return""+I;if("[object Number]"==h)return I===Number.POSITIVE_INFINITY?"Infinity":I===Number.NEGATIVE_INFINITY?"NInfinity":isNaN(I)?"NaN":""+I;if("[object RegExp]"==h)return S=I.source,A+=I.ignoreCase?"i":"",A+=I.global?"g":"",A+=I.multiline?"m":"",S=d(s?S.split(""):S),A=d(s?A.split(""):A),I="^"+S+A;if("[object String]"==h)return I=d(s?I.split(""):I),"[object Date]"==g&&(I="%"+I),I;if("object"==typeof I){for(w=m.length;w--;)if(m[w]===I)return"&"+w;if(m.push(I),v=[],_=f,f+=c,"[object Array]"==h){for(b=0,w=I.length;w>b;C||(C=!0),b++)y=p(b,I,o,u,c,f,m),v.push(y===r?"null":y);E=C?c?"[\n"+f+v.join(",\n"+f)+"\n"+_+"]":"["+v.join(",")+"]":"[]"}else n(u||I,function(e){var t=p(e,I,o,u,c,f,m);t!==r&&v.push(d(s?e.split(""):e)+":"+(c?" ":"")+t),C||(C=!0)}),E=C?c?"{\n"+f+v.join(",\n"+f)+"\n"+_+"}":"{"+v.join(",")+"}":"{}";return E}}};Kamino.stringify=function(e,t,n){var r,a,o;if("function"==typeof t||"object"==typeof t&&t)if("[object Function]"==i.call(t))a=t;else if("[object Array]"==i.call(t)){o={};for(var s,u=0,c=t.length;c>u;s=t[u++],("[object String]"==i.call(s)||"[object Number]"==i.call(s))&&(o[s]=1));}if(n)if("[object Number]"==i.call(n)){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==i.call(n)&&(r=n.length<=10?n:n.slice(0,10));return p("",(s={},s[""]=e,s),a,o,r,"",[])};var f,m,g,h=String.fromCharCode,v={"\\":"\\",'"':'"',"/":"/",b:"\b",t:"	",n:"\n",f:"\f",r:"\r"},y=function(){throw f=m=null,SyntaxError()},b=function(e){e=e||"";var t,n,r,i,a=m,o=a.length;for(t=e,f++;o>f;)if(n=a[f]," ">n)y();else if("\\"==n)if(n=a[++f],'\\"/btnfr'.indexOf(n)>-1)t+=v[n],f++;else if("u"==n){for(r=++f,i=f+4;i>f;f++)n=a[f],n>="0"&&"9">=n||n>="a"&&"f">=n||n>="A"&&"F">=n||y();t+=h("0x"+a.slice(r,f))}else y();else{if('"'==n)break;t+=n,f++}return'"'==a[f]?(f++,t):void y()},w=function(){for(var e,t,n,r,i,a,o,s=m,u=s.length;u>f;)if(e=s[f],"	\r\n ".indexOf(e)>-1)f++;else{if("{}[]:,".indexOf(e)>-1)return f++,e;if('"'==e)return b("@");if("%"==e){if(f++,e=s[f],'"'==e)return i=b(),new Date(i);y()}else if("^"==e){if(f++,e=s[f],'"'==e&&(a=b(),e=s[f],'"'==e))return o=b(),new RegExp(a,o);y()}else if("&"==e){if(f++,e=s[f],e>="0"&&"9">=e)return f++,g[e];y()}else{if(t=f,"-"==e&&(r=!0,e=s[++f]),e>="0"&&"9">=e){for("0"==e&&(e=s[f+1],e>="0"&&"9">=e)&&y(),r=!1;u>f&&(e=s[f],e>="0"&&"9">=e);f++);if("."==s[f]){for(n=++f;u>n&&(e=s[n],e>="0"&&"9">=e);n++);n==f&&y(),f=n}if(e=s[f],"e"==e||"E"==e){for(e=s[++f],("+"==e||"-"==e)&&f++,n=f;u>n&&(e=s[n],e>="0"&&"9">=e);n++);n==f&&y(),f=n}return+s.slice(t,f)}if(r&&y(),"true"==s.slice(f,f+4))return f+=4,!0;if("false"==s.slice(f,f+5))return f+=5,!1;if("Infinity"==s.slice(f,f+8))return f+=8,1/0;if("NInfinity"==s.slice(f,f+9))return f+=9,-(1/0);if("NaN"==s.slice(f,f+3))return f+=3,NaN;if("null"==s.slice(f,f+4))return f+=4,null;y()}}return"$"},_=function(e){var t,n;if("$"==e&&y(),"string"==typeof e){if("@"==e[0])return e.slice(1);if("["==e){for(t=[],g[g.length]=t;e=w(),"]"!=e;n||(n=!0))n&&(","==e?(e=w(),"]"==e&&y()):y()),","==e&&y(),t.push(_("string"==typeof e&&s?e.split(""):e));return t}if("{"==e){for(t={},g[g.length]=t;e=w(),"}"!=e;n||(n=!0)){n&&(","==e?(e=w(),"}"==e&&y()):y()),(","==e||"string"!=typeof e||"@"!=e[0]||":"!=w())&&y();var r=w();t[e.slice(1)]=_("string"==typeof r&&s?r.split(""):r)}return t}y()}return e},C=function(e,t,n){var i=E(e,t,n);i===r?delete e[t]:e[t]=i},E=function(e,t,r){var a,o=e[t];if("object"==typeof o&&o)if("[object Array]"==i.call(o))for(a=o.length;a--;)C(o,a,r);else n(o,function(e){C(o,e,r)});return r.call(e,t,o)};Kamino.parse=function(e,t){var n,r;return f=0,m=""+e,g=[],s&&(m=e.split("")),n=_(w()),"$"!=w()&&y(),f=m=null,t&&"[object Function]"==i.call(t)?E((r={},r[""]=n,r),"",t):n},Kamino.clone=function(e){return Kamino.parse(Kamino.stringify(e))}}(this),r("kamino",function(){}),function(t){function n(e){return e&&"[object Function]"===Object.prototype.toString.call(e)}function r(){return"undefined"==typeof Worker&&"undefined"==typeof a}var i=t,a=i.Window,o=!1,s=[].slice;if(o||!i.MessageChannel){var u=function(e){return"undefined"!=typeof window&&i instanceof a&&(!n(i.Worker)||!(e instanceof Worker))},c=function(e){if(p.verbose){var t=s.apply(arguments);t.unshift("MCNP: "),console.log.apply(console,t)}},d={},l=i.MessagePort=function(t){this._entangledPortUuid=null,this.destinationUrl=null,this._listeners={},this._messageQueue=[],this._messageQueueEnabled=!1,this._currentTarget=null,this.uuid=t||e.generate(),d[this.uuid]=this,this.log("created")};l.prototype={start:function(){var e,t=this;setTimeout(function(){for(t.log("draining "+t._messageQueue.length+" queued messages");t._messageQueueEnabled&&(e=t._messageQueue.shift());)t.dispatchEvent(e)}),this._messageQueueEnabled=!0,this.log("started")},close:function(){this._messageQueueEnabled=!1,this._entangledPortUuid&&(this._getEntangledPort()._entangledPortUuid=null,this._entangledPortUuid=null)},postMessage:function(e){var t,n=this._getEntangledPort(),r=this._currentTarget;return n?void(r?(t=p.encodeEvent(e,[n],!0),u(r)?(this.log("posting message from window to window",e,this.destinationUrl),r.postMessage(t,this.destinationUrl)):(this.log("posting message from or to worker",e),r.postMessage(t))):(this.log("not connected, queueing message",e),n._enqueueEvent(p._messageEvent(e,[n],!0)))):void this.log("not entangled, discarding message",e)},addEventListener:function(e,t){"undefined"==typeof this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push(t)},removeEventListener:function(e,t){if(this._listeners[e]instanceof Array)for(var n=this._listeners[e],r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=this._listeners.message;if(t)for(var n=0;n<t.length;n++)t[n].call(this,e)},_enqueueEvent:function(e){this._messageQueueEnabled?this.dispatchEvent(e):this._messageQueue.push(e)},_getPort:function(e,t,n){var r=function(e){var t=d[e]||p._createPort(e);return t},a=r(e.uuid);if(a._entangledPortUuid=e._entangledPortUuid,a._getEntangledPort()._entangledPortUuid=a.uuid,a._currentTarget=t.source||t.currentTarget||i,"null"===t.origin?a.destinationUrl="*":a.destinationUrl=t.origin,n)for(var o=0;o<e._messageQueue.length;o++)a._messageQueue.push(e._messageQueue[o]);return a},_getEntangledPort:function(){return this._entangledPortUuid?d[this._entangledPortUuid]||p._createPort(this._entangledPortUuid):null},log:function(){if(p.verbose){var e=s.apply(arguments);e.unshift("Port",this.uuid),c.apply(null,e)}}};var p=i.MessageChannel=function(){var e,t=p._createPort(),n=p._createPort();return t._entangledPortUuid=n.uuid,n._entangledPortUuid=t.uuid,e={port1:t,port2:n},p.log(e,"created"),e};p.log=function(e){if(p.verbose){var t=["Chnl"],n=s.call(arguments,1);e.port1&&e.port2?t.push(e.port1.uuid,e.port2.uuid):e.forEach(function(e){t.push(e._entangledPortUuid)}),t.push.apply(t,n),c.apply(null,t)}},p._createPort=function(){var e=arguments,t=function(){return l.apply(this,e)};return t.prototype=l.prototype,new t},p.encodeEvent=function(e,t,n){for(var r,i,a=new Array(t.length),o=0;o<t.length;++o)a[o]=p._strippedPort(t[o]);return i={event:p._messageEvent(e,a,n)},r=Kamino.stringify(i)},p._messageEvent=function(e,t,n){return{data:e,ports:t,messageChannel:n}},p._strippedPort=function(e){if(e){for(var t,n,r,i=[],a=0;a<e._messageQueue.length;++a){t=e._messageQueue[a],n=t.ports||[],r=[];for(var o,s=0;s<n.length;++s)o=n[s],r.push({uuid:o.uuid,_entangledPortUuid:o._entangledPortUuid});i.push({data:t.data,messageChannel:t.messageChannel,ports:r})}return{uuid:e.uuid,_entangledPortUuid:e._entangledPortUuid,_messageQueue:i}}},p.decodeEvent=function(e,t){var n={data:null,ports:[]},r=Kamino.parse(e.data),i=r.event,a=i.ports;if(i){if(a)for(var o=0;o<a.length;o++)n.ports.push(l.prototype._getPort(a[o],e,t));n.data=i.data,n.source=e.source,n.messageChannel=i.messageChannel}return n};var f=function(e,t){var n;try{n=p.decodeEvent(e,t)}catch(r){if(!(r instanceof SyntaxError))throw r;n=e}return n},m=function(e){var t=f(e,!0);t.messageChannel&&p.propagateEvent(t)},g=function(e){e.addEventListener?e.addEventListener("message",m,!1):e.attachEvent&&e.attachEvent("onmessage",m)},h=function(e){var t,n,r,i,a;e.addEventListener?(n="addEventListener",i="removeEventListener",a="message"):e.attachEvent&&(n="attachEvent",i="detachEvent",a="onmessage"),t=e[n],r=e[i],e[n]=function(){var e,n=Array.prototype.slice.call(arguments),r=n[1],i=this;n[0]===a&&(e=function(e){var t=f(e);t.messageChannel||r.call(i,t)},r.messageHandlerWrapper=e,n[1]=e),t.apply(this,n)},e[i]=function(){var e=Array.prototype.slice.call(arguments),t=e[1];e[0]===a&&(e[1]=t.messageHandlerWrapper,delete t.messageHandlerWrapper),e[1]&&r.apply(this,e)}};if(p.propagateEvent=function(e){var t,n,r;if(e.messageChannel){t=e.ports;for(var i=0;i<t.length;i++)n=t[i],r=n._getEntangledPort(),n._currentTarget&&r._currentTarget?r.postMessage(e.data):n._enqueueEvent(e)}},p.reset=function(){d={}},g(i),a){a.postMessage=function(e,t,n,r){var i,a;if(r=r||[],i=p.encodeEvent(t,r,!1),r)for(var o=0;o<r.length;o++)a=r[o]._getEntangledPort(),a._currentTarget||(a._currentTarget=e,a.destinationUrl=n);p.log(r,"handshake window",e),e.postMessage(i,n)};var v;if(window.addEventListener)v=window;else{if(!window.attachEvent)throw"We couldn't find a method to attach an event handler.";v=a.prototype}h(v)}else h(i);if(i.Worker){var y,b=Worker;b.prototype.addEventListener?y=b.prototype.addEventListener:b.prototype.attachEvent&&(y=b.prototype.attachEvent),i.Worker=function(){var e=new b(arguments[0]),t=y;return t.call(e,"message",m),e},Worker.prototype=b.prototype,h(Worker.prototype)}else r()&&(i.Worker={});i.Worker&&(i.Worker.postMessage=function(e,t,n){for(var r,i=p.encodeEvent(t,n,!1),a=0;a<n.length;a++)r=n[a]._getEntangledPort(),r._currentTarget=e;p.log(n,"handshake worker",e),e.postMessage(i)})}else a?a.postMessage=function(e,t,n,r){r=r||[],e.postMessage(t,n,r)}:i.Worker={postMessage:function(e,t,n){e.postMessage(t,n)}},i.Worker&&(i.Worker.postMessage=function(e,t,n){e.postMessage(t,n)})}(this),r("MessageChannel",function(){}),r("glympse-adapter/lib/utils",["require","exports","module"],function(e,t,n){function r(e,t){return function(){return e&&e[t]}}function i(e,t){return function(){var n=e&&e[t];return n&&(n.v||n)}}var a="__gacfg",o=window.localStorage,s={dbg:function(e,t){return function(n,r,i){(!t||t>=0&&i>=t)&&console.log("["+e+"] "+n+(void 0!==r&&": "+JSON.stringify(r,null,"  ")||""))}},generateClone:function(e){if(!(e instanceof Object))return e;var t=e.constructor;if(t===Function)return null;var n=new t;for(var r in e)e.hasOwnProperty(r)&&(n[r]=s.generateClone(e[r]));return n},domain:window.location.hostname,getCookie:function(e){if(o){var t=o.getItem(e);if(null!==t)return t}for(var n=document.cookie.split(";"),r=n.length-1;r>=0;r--){var i=n[r],a=i.indexOf("="),s=i.substr(0,a);if(s.replace(/^\s+|\s+$/g,"")===e)return window.decodeURIComponent(i.substr(a+1))}return null},setCookie:function(e,t,n){if(o)try{return void o.setItem(e,t)}catch(r){console.log("localStorage error",r)}var i=new Date;i.setTime(i.getTime()+24*(n||365)*3600*1e3),document.cookie=e+"="+t+"; expires="+i.toGMTString()+"; domain="+s.domain+"; path=/"},getCfgVal:function(e,t){var n=s.getCookie(t||a);return n?JSON.parse(n)[e]:null},setCfgVal:function(e,t,n,r){var i=n||a,o=s.getCookie(i);o=o?JSON.parse(o):{},o[e]=t,s.setCookie(i,JSON.stringify(o),r)},capFirst:function(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)},toUpperCamel:function(e){for(var t=e&&e.split("_")||"",n="",r=0,i=t.length;i>r;r++)n+=s.capFirst(t[r]);return n},mapProps:function(e,t,n,a){for(var o=0,u=t.length;u>o;o++){var c=t[o];e["get"+s.toUpperCamel(c)]=a?i(n,c):r(n,c)}},simplifyInvite:function(e){return e&&e.toLowerCase().split("-").join("")||""},normalizeInvite:function(e){if(e){e=e.toUpperCase();var t=e.length,n=t/2;(6===t||8===t)&&(e=e.substr(0,n)+"-"+e.substr(n,n))}return e},cleanInvites:function(e){e=e||[];for(var t=0,n=e.length;n>t;t++)e[t]=s.simplifyInvite(e[t]);return e}};Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),n.exports=s}),function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(){}function o(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function s(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function u(e,t){return"onerror"===e?void Ee.on("error",t):2!==arguments.length?Ee[e]:void(Ee[e]=t)}function c(){setTimeout(function(){for(var e,t=0;t<Se.length;t++){e=Se[t];var n=e.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),Ee.trigger(e.name,e.payload)}Se.length=0},50)}function d(e,t,n){1===Se.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:we(),error:Ee["instrument-with-stack"]?new Error(t._label):null}})&&c()}function l(){return new TypeError("A promises callback cannot return that same promise.")}function p(){}function f(e){try{return e.then}catch(t){return ke.error=t,ke}}function m(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function g(e,t,n){Ee.async(function(e){var r=!1,i=m(n,t,function(n){r||(r=!0,t!==n?y(e,n):w(e,n))},function(t){r||(r=!0,_(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,_(e,i))},e)}function h(e,t){t._state===xe?w(e,t._result):t._state===Te?(t._onError=null,_(e,t._result)):C(t,void 0,function(n){t!==n?y(e,n):w(e,n)},function(t){_(e,t)})}function v(e,n){if(n.constructor===e.constructor)h(e,n);else{var r=f(n);r===ke?_(e,ke.error):void 0===r?w(e,n):t(r)?g(e,n,r):w(e,n)}}function y(t,n){t===n?w(t,n):e(n)?v(t,n):w(t,n)}function b(e){e._onError&&e._onError(e._result),E(e)}function w(e,t){e._state===Ae&&(e._result=t,e._state=xe,0===e._subscribers.length?Ee.instrument&&Ie("fulfilled",e):Ee.async(E,e))}function _(e,t){e._state===Ae&&(e._state=Te,e._result=t,Ee.async(b,e))}function C(e,t,n,r){var i=e._subscribers,a=i.length;e._onError=null,i[a]=t,i[a+xe]=n,i[a+Te]=r,0===a&&e._state&&Ee.async(E,e)}function E(e){var t=e._subscribers,n=e._state;if(Ee.instrument&&Ie(n===xe?"fulfilled":"rejected",e),0!==t.length){for(var r,i,a=e._result,o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?A(n,r,i,a):i(a);e._subscribers.length=0}}function S(){this.error=null}function I(e,t){try{return e(t)}catch(n){return Re.error=n,Re}}function A(e,n,r,i){var a,o,s,u,c=t(r);if(c){if(a=I(r,i),a===Re?(u=!0,o=a.error,a=null):s=!0,n===a)return void _(n,l())}else a=i,s=!0;n._state!==Ae||(c&&s?y(n,a):u?_(n,o):e===xe?w(n,a):e===Te&&_(n,a))}function x(e,t){var n=!1;try{t(function(t){n||(n=!0,y(e,t))},function(t){n||(n=!0,_(e,t))})}catch(r){_(e,r)}}function T(e,t,n){return e===xe?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function k(e,t,n,r){this._instanceConstructor=e,this.promise=new e(p,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):_(this.promise,this._validationError())}function R(e,t){return new Oe(this,e,!0,t).promise}function O(e,t){function n(e){y(a,e)}function r(e){_(a,e)}var i=this,a=new i(p,t);if(!be(e))return _(a,new TypeError("You must pass an array to race.")),a;for(var o=e.length,s=0;a._state===Ae&&o>s;s++)C(i.resolve(e[s]),void 0,n,r);return a}function D(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var r=new n(p,t);return y(r,e),r}function U(e,t){var n=this,r=new n(p,t);return _(r,e),r}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function L(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function M(e,n){this._id=je++,this._label=n,this._state=void 0,this._result=void 0,this._subscribers=[],Ee.instrument&&Ie("created",this),p!==e&&(t(e)||P(),this instanceof M||L(),x(this,e))}function j(e,t,n){this._superConstructor(e,t,!1,n)}function N(e,t){return new j(Ne,e,t).promise}function q(e,t){return Ne.all(e,t)}function G(e,t){Ye[He]=e,Ye[He+1]=t,He+=2,2===He&&Ge()}function z(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){e(Q)}}function F(){return function(){qe(Q)}}function H(){var e=0,t=new We(Q),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function V(){var e=new MessageChannel;return e.port1.onmessage=Q,function(){e.port2.postMessage(0)}}function J(){return function(){setTimeout(Q,1)}}function Q(){for(var e=0;He>e;e+=2){var t=Ye[e],n=Ye[e+1];t(n),Ye[e]=void 0,Ye[e+1]=void 0}He=0}function W(){try{var e=n,t=e("vertx");return qe=t.runOnLoop||t.runOnContext,F()}catch(r){return J()}}function K(e){var t={};return t.promise=new Ne(function(e,n){t.resolve=e,t.reject=n},e),t}function $(e,n,r){return Ne.all(e,r).then(function(e){if(!t(n))throw new TypeError("You must pass a function as filter's second argument.");for(var i=e.length,a=new Array(i),o=0;i>o;o++)a[o]=n(e[o]);return Ne.all(a,r).then(function(t){for(var n=new Array(i),r=0,a=0;i>a;a++)t[a]&&(n[r]=e[a],r++);return n.length=r,n})})}function Y(e,t,n){this._superConstructor(e,t,!0,n)}function Z(e,t,n){this._superConstructor(e,t,!1,n)}function B(e,t){return new Z(Ne,e,t).promise}function X(e,t){return new Xe(Ne,e,t).promise}function ee(e,n,r){return Ne.all(e,r).then(function(e){if(!t(n))throw new TypeError("You must pass a function as map's second argument.");for(var i=e.length,a=new Array(i),o=0;i>o;o++)a[o]=n(e[o]);return Ne.all(a,r)})}function te(){this.value=void 0}function ne(e){try{return e.then}catch(t){return rt.value=t,rt}}function re(e,t,n){try{e.apply(t,n)}catch(r){return rt.value=r,rt}}function ie(e,t){for(var n,r,i={},a=e.length,o=new Array(a),s=0;a>s;s++)o[s]=e[s];for(r=0;r<t.length;r++)n=t[r],i[n]=o[r+1];return i}function ae(e){for(var t=e.length,n=new Array(t-1),r=1;t>r;r++)n[r-1]=e[r];return n}function oe(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function se(e,t){var n=function(){for(var n,r=this,i=arguments.length,a=new Array(i+1),o=!1,s=0;i>s;++s){if(n=arguments[s],!o){if(o=de(n),o===it){var u=new Ne(p);return _(u,it.value),u}o&&o!==!0&&(n=oe(o,n))}a[s]=n}var c=new Ne(p);return a[i]=function(e,n){e?_(c,e):void 0===t?y(c,n):t===!0?y(c,ae(arguments)):be(t)?y(c,ie(arguments,t)):y(c,n)},o?ce(c,a,e,r):ue(c,a,e,r)};return n.__proto__=e,n}function ue(e,t,n,r){var i=re(n,r,t);return i===rt&&_(e,i.value),e}function ce(e,t,n,r){return Ne.all(t).then(function(t){var i=re(n,r,t);return i===rt&&_(e,i.value),e})}function de(e){return e&&"object"==typeof e?e.constructor===Ne?!0:ne(e):!1}function le(e,t){return Ne.race(e,t)}function pe(e,t){return Ne.reject(e,t)}function fe(e,t){return Ne.resolve(e,t)}function me(e){throw setTimeout(function(){throw e}),e}function ge(e,t){Ee.async(e,t)}function he(){Ee.on.apply(Ee,arguments)}function ve(){Ee.off.apply(Ee,arguments)}var ye;ye=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var be=ye,we=Date.now||function(){return(new Date).getTime()},_e=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return a.prototype=e,new a},Ce={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var n,r=s(this);n=r[e],n||(n=r[e]=[]),-1===o(n,t)&&n.push(t)},off:function(e,t){var n,r,i=s(this);return t?(n=i[e],r=o(n,t),void(-1!==r&&n.splice(r,1))):void(i[e]=[])},trigger:function(e,t){var n,r,i=s(this);if(n=i[e])for(var a=0;a<n.length;a++)(r=n[a])(t)}},Ee={instrument:!1};Ce.mixin(Ee);var Se=[],Ie=d,Ae=void 0,xe=1,Te=2,ke=new S,Re=new S,Oe=k;k.prototype._validateInput=function(e){return be(e)},k.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},k.prototype._init=function(){this._result=new Array(this.length)},k.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,r=0;t._state===Ae&&e>r;r++)this._eachEntry(n[r],r)},k.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;i(e)?e.constructor===n&&e._state!==Ae?(e._onError=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(xe,t,e))},k.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===Ae&&(this._remaining--,this._abortOnReject&&e===Te?_(r,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&w(r,this._result)},k.prototype._makeResult=function(e,t,n){return n},k.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){n._settledAt(xe,t,e)},function(e){n._settledAt(Te,t,e)})};var De=R,Ue=O,Pe=D,Le=U,Me="rsvp_"+we()+"-",je=0,Ne=M;M.cast=Pe,M.all=De,M.race=Ue,M.resolve=Pe,M.reject=Le,M.prototype={constructor:M,_guidKey:Me,_onError:function(e){Ee.async(function(t){setTimeout(function(){t._onError&&Ee.trigger("error",e)},0)},this)},then:function(e,t,n){var r=this,i=r._state;if(i===xe&&!e||i===Te&&!t)return Ee.instrument&&Ie("chained",this,this),this;r._onError=null;var a=new this.constructor(p,n),o=r._result;if(Ee.instrument&&Ie("chained",r,a),i){var s=arguments[i-1];Ee.async(function(){A(i,a,s,o)})}else C(r,a,e,t);return a},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}},j.prototype=_e(Oe.prototype),j.prototype._superConstructor=Oe,j.prototype._makeResult=T,j.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var qe,Ge,ze=N,Fe=q,He=0,Ve=({}.toString,G),Je="undefined"!=typeof window?window:void 0,Qe=Je||{},We=Qe.MutationObserver||Qe.WebKitMutationObserver,Ke="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$e="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Ye=new Array(1e3);Ge=Ke?z():We?H():$e?V():void 0===Je&&"function"==typeof n?W():J();var Ze=K,Be=$,Xe=Y;Y.prototype=_e(Oe.prototype),Y.prototype._superConstructor=Oe,Y.prototype._init=function(){this._result={}},Y.prototype._validateInput=function(e){return e&&"object"==typeof e},Y.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},Y.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var r in t)e._state===Ae&&t.hasOwnProperty(r)&&n.push({position:r,entry:t[r]});var i=n.length;this._remaining=i;for(var a,o=0;e._state===Ae&&i>o;o++)a=n[o],this._eachEntry(a.entry,a.position)},Z.prototype=_e(Xe.prototype),Z.prototype._superConstructor=Oe,Z.prototype._makeResult=T,Z.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var et=B,tt=X,nt=ee,rt=new te,it=new te,at=se,ot=le,st=pe,ut=fe,ct=me;Ee.async=Ve;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var dt=window.__PROMISE_INSTRUMENTATION__;u("instrument",!0);for(var lt in dt)dt.hasOwnProperty(lt)&&he(lt,dt[lt])}var pt={race:ot,Promise:Ne,allSettled:ze,hash:tt,hashSettled:et,denodeify:at,on:he,off:ve,map:nt,filter:Be,resolve:ut,reject:st,all:Fe,rethrow:ct,defer:Ze,EventTarget:Ce,configure:u,async:ge};"function"==typeof r&&r.amd?r("rsvp",[],function(){return pt}):"undefined"!=typeof module&&module.exports?module.exports=pt:"undefined"!=typeof this&&(this.RSVP=pt)}.call(this),r("oasis/shims",["exports"],function(e){"use strict";function t(e,t){if(a.prototype=e,e=new a,t){a.prototype=e;for(var n in t)a.prototype[n]=t[n].value;e=new a}return a.prototype=null,e}function n(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):void 0}function r(e,t,n){return e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):void 0}function i(e){return e&&Function.prototype.toString.call(e).indexOf("[native code]")>-1}var a=function(){},o=i(Array.prototype.forEach)?Array.prototype.forEach:function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],i=0;n>i;i++)i in t&&e.call(r,t[i],i,t)},s=i(Array.prototype.reduce)?Array.prototype.reduce:function(e,t){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,r=0,i=this.length>>>0,a=!1;for(1<arguments.length&&(n=t,a=!0);i>r;++r)this.hasOwnProperty(r)&&(a?n=e(n,this[r],r,this):(n=this[r],a=!0));if(!a)throw new TypeError("Reduce of empty array with no initial value");return n},u=i(Array.prototype.map)?Array.prototype.map:function(e,t){var n,r,i;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(n=t),r=new Array(o),i=0;o>i;){var s,u;i in a&&(s=a[i],u=e.call(n,s,i,a),r[i]=u),i++}return r},c=i(Array.prototype.indexOf)?Array.prototype.indexOf:function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-(1/0)&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);n>i;i++)if(i in t&&t[i]===e)return i;return-1},d=i(Array.prototype.filter)?Array.prototype.filter:function(e){if(!this)throw new TypeError;var t=Object(this);t.length>>>0;
if("function"!=typeof e)throw new TypeError;var n=[],r=arguments[1];for(var i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i,t)&&n.push(t[i]);return n};e.o_create=t,e.addEventListener=n,e.removeEventListener=r,e.a_forEach=o,e.a_reduce=s,e.a_map=u,e.a_indexOf=c,e.a_filter=d}),r("oasis/util",["oasis/shims","exports"],function(e,t){"use strict";function n(e,t){if(!e)throw new Error(t)}function r(){}function i(e,t){return function(){throw new Error("Subclasses of "+e+" must implement "+t)}}function a(e,t){function n(){e.apply(this,arguments),this.initialize&&this.initialize.apply(this,arguments)}n.prototype=c(e.prototype);for(var r in t)t.hasOwnProperty(r)&&(n.prototype[r]=t[r]);return n}function o(e,t){return function(){var n=this[e];return n[t].apply(n,arguments)}}function s(){var e={};return d.call(this,function(t){var n=!e.hasOwnProperty(t);return e[t]=!0,n})}function u(e,t){for(var n in t)t.hasOwnProperty(n)&&(n in e||(e[n]=t[n]));return e}var c=e.o_create,d=e.a_filter;t.assert=n,t.noop=r,t.mustImplement=i,t.extend=a,t.delegate=o,t.uniq=s,t.reverseMerge=u}),r("oasis/xhr",["oasis/util","rsvp","exports"],function(e,t,n){"use strict";function r(e){var t=e.dataType;return t&&g[t]?g[t]:g["*"]}function i(e,t){e.setRequestHeader("Accepts",r(t))}function a(e){return e.status}function o(){return 200}function s(e,t){if(t){var n=f.call(arguments,2);n.unshift(e),t.trigger.apply(t,n)}}function u(e,n,r){return!r&&this instanceof Oasis&&(r=this),n||(n=m),new t.Promise(function(t,i){var a=new c;a.open("get",e,!0),d(a,n),n.timeout&&(a.timeout=n.timeout),a.onload=function(){s("xhr.load",r,e,n,a);var o=l(a);o>=200&&300>o?t(a.responseText):i(a)},a.onprogress=p,a.ontimeout=function(){s("xhr.timeout",r,e,n,a),i(a)},a.onerror=function(){s("xhr.error",r,e,n,a),i(a)},s("xhr.send",r,e,n,a),a.send()})}var c,d,l,p=e.noop,f=Array.prototype.slice,m={},g={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"};try{"withCredentials"in new XMLHttpRequest?(c=XMLHttpRequest,d=i,l=a):"undefined"!=typeof XDomainRequest&&(c=XDomainRequest,d=p,l=o)}catch(h){"undefined"!=typeof XDomainRequest&&(c=XDomainRequest,d=p,l=o)}n.xhr=u}),r("oasis/message_channel",["oasis/util","rsvp","exports"],function(e,t,n){"use strict";function r(e,t){}function i(e){return e.oasisId+"-"+e.requestId++}function a(e){}var o=e.extend,s=e.mustImplement;r.prototype={on:s("OasisPort","on"),all:s("OasisPort","all"),off:s("OasisPort","off"),send:s("OasisPort","send"),start:s("OasisPort","start"),close:s("OasisPort","close"),request:function(e){var n=this.oasis,r=this,a=[].slice.call(arguments,1);return new t.Promise(function(t,o){var s=i(n),u=function(){r.off("@response:"+e,c),r.off("@errorResponse:"+e,d)},c=function(e){e.requestId===s&&(u(),t(e.data))},d=function(e){e.requestId===s&&(u(),o(e.data))};r.on("@response:"+e,c,r),r.on("@errorResponse:"+e,d,r),r.send("@request:"+e,{requestId:s,args:a})})},onRequest:function(e,n,r){var i=this;this.on("@request:"+e,function(a){var o=a.requestId,s=(a.args,new t.Promise(function(t,i){var o=n.apply(r,a.args);void 0!==o?t(o):i("@request:"+e+" ["+a.requestId+"] did not return a value.  If you want to return a literal `undefined` return `RSVP.resolve(undefined)`")}));s.then(function(t){i.send("@response:"+e,{requestId:o,data:t})},function(t){var n=t;t instanceof Error&&(n={message:t.message,stack:t.stack}),i.send("@errorResponse:"+e,{requestId:o,data:n})})})}},a.prototype={start:s("OasisMessageChannel","start")};var u=o(a,{initialize:function(e){this.channel=new MessageChannel,this.port1=new c(e,this.channel.port1),this.port2=new c(e,this.channel.port2)},start:function(){this.port1.start(),this.port2.start()},destroy:function(){this.port1.close(),this.port2.close(),delete this.port1,delete this.port2,delete this.channel}}),c=o(r,{initialize:function(e,t){this.oasis=e,this.port=t,this._callbacks=[]},on:function(e,t,n){function r(r){r.data.type===e&&i.configuration.eventCallback(function(){return t.call(n,r.data.data)})}var i=this.oasis;this._callbacks.push([t,r]),this.port.addEventListener("message",r)},all:function(e,t){function n(n){r.configuration.eventCallback(function(){e.call(t,n.data.type,n.data.data)})}var r=this.oasis;this.port.addEventListener("message",n)},off:function(e,t){for(var n,r=0,i=this._callbacks.length;i>r;r++)n=this._callbacks[r],n[0]===t&&this.port.removeEventListener("message",n[1])},send:function(e,t){this.port.postMessage({type:e,data:t})},start:function(){this.port.start()},close:function(){for(var e,t=0,n=this._callbacks.length;n>t;t++)e=this._callbacks[t],this.port.removeEventListener("message",e[1]);this._callbacks=[],this.port.close()}});n.OasisPort=r,n.PostMessageMessageChannel=u,n.PostMessagePort=c}),r("oasis/logger",[],function(){"use strict";function e(){this.enabled=!1}e.prototype={enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},log:function(){if(t.enabled)if("undefined"!=typeof console&&"function"==typeof console.log)console.log.apply(console,arguments);else if("undefined"!=typeof console&&"object"==typeof console.log)try{switch(arguments.length){case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;default:console.log(arguments[0],arguments[1],arguments[2])}}catch(e){}}};var t=new e;return t}),r("oasis/connect",["oasis/util","oasis/shims","oasis/message_channel","rsvp","oasis/logger","exports"],function(e,t,n,r,i,a){"use strict";function o(e,t,n){var a=e.ports[t];a?(i.log(e.oasisId,"sandbox: found port, setting up '"+t+"'"),n.setupCapability(a),n.promise?n.promise.then(function(){a.start()})["catch"](r.rethrow):a.start()):e.receivedPorts?(i.log("No port was sent for capability '"+t+"'"),n.rejectCapability()):(i.log("No port found, saving handler for '"+t+"'"),e.handlers[t]=n)}function s(e,t,n){return"object"==typeof e?d(this,e.consumers):t?l(this,e,t,n):p(this,e)}function u(e,t){var n=this;m.call(e,function(e,a){var o=n.handlers[e],s=new g(n,t[a]);o&&(i.log("Invoking handler for '"+e+"'"),r.resolve(o.setupCapability(s)).then(function(){s.start()})["catch"](r.rethrow)),n.ports[e]=s});for(var a in n.handlers)n.ports[a]||n.handlers[a].rejectCapability();this.receivedPorts=!0}function c(e){var t=this.ports[e];return f(t,"You asked for the port for the '"+e+"' capability, but the environment did not provide one."),t}function d(e,t){function n(t,n){return function(r){var i=new t(r);e.consumers[n]=i,i.initialize(r,n)}}function r(e){return function(){t[e].prototype.error()}}for(var i in t)o(e,i,{setupCapability:n(t[i],i),rejectCapability:r(i)})}function l(e,t,n,r){i.log("Connecting to '"+t+"' with callback."),o(e,t,{setupCapability:function(e){n(e)},rejectCapability:function(){r&&r()}})}function p(e,t){i.log("Connecting to '"+t+"' with promise.");var n=r.defer();return o(e,t,{promise:n.promise,setupCapability:function(e){return n.resolve(e),n.promise},rejectCapability:function(){n.reject()}}),n.promise}var f=e.assert,m=t.a_forEach,g=n.PostMessagePort;a.registerHandler=o,a.connect=s,a.connectCapabilities=u,a.portFor=c}),r("oasis/version",[],function(){"use strict";return"0.4.0"}),r("oasis/config",[],function(){"use strict";function e(){this.eventCallback=function(e){e()},this.allowSameOrigin=!1,this.reconnect="verify"}return e}),r("oasis/sandbox",["oasis/util","oasis/shims","oasis/message_channel","rsvp","oasis/logger"],function(e,t,n,r,i){"use strict";var a=e.assert,o=e.uniq,s=e.reverseMerge,u=t.a_forEach,c=t.a_reduce,d=(t.a_filter,n.OasisPort),l=function(e,t){t=s(t||{},{reconnect:e.configuration.reconnect});var n=t.reconnect;a("none"===n||"verify"===n||"any"===n,"`reconnect` must be one of 'none', 'verify' or 'any'.  '"+n+"' is invalid."),this.connections={},this.wiretaps=[],this.oasis=e;var r=e.packages[t.url],i=t.capabilities;i||(a(r,"You are trying to create a sandbox from an unregistered URL without providing capabilities. Please use Oasis.register to register your package or pass a list of capabilities to createSandbox."),i=r.capabilities),r=r||{},this.adapter=t.adapter||Oasis.adapters.iframe,this._capabilitiesToConnect=this._filterCapabilities(i),this.envPortDefereds={},this.sandboxPortDefereds={},this.channels={},this.capabilities={},this.options=t,this.firstLoad=!0;this.promisePorts(),this.adapter.initializeSandbox(this)};return l.prototype={waitForLoad:function(){return this._waitForLoadDeferred().promise},wiretap:function(e){this.wiretaps.push(e)},connect:function(e){var t=this.envPortDefereds[e].promise;return a(t,"Connect was called on '"+e+"' but no such capability was registered."),t},createAndTransferCapabilities:function(){this.firstLoad||this.promisePorts(),this.createChannels(),this.connectPorts(),this.firstLoad=!1},promisePorts:function(){u.call(this._capabilitiesToConnect,function(e){this.envPortDefereds[e]=r.defer(),this.sandboxPortDefereds[e]=r.defer()},this)},createChannels:function(){var e=this,t=this.options.services||{},n=this.channels;u.call(this._capabilitiesToConnect,function(r){i.log("container: Will create port for '"+r+"'");var a,o,s=t[r];if(s instanceof d)o=this.adapter.proxyPort(this,s),this.capabilities[r]=s;else{a=n[r]=this.adapter.createChannel(e.oasis);var c=this.adapter.environmentPort(this,a),l=this.adapter.sandboxPort(this,a);i.log("container: Wiretapping '"+r+"'"),c.all(function(e,t){u.call(this.wiretaps,function(n){n(r,{type:e,data:t,direction:"received"})})},this),u.call(this.wiretaps,function(e){var t=c.send;c.send=function(n,i){e(r,{type:n,data:i,direction:"sent"}),t.apply(c,arguments)}}),s&&(i.log("container: Creating service for '"+r+"'"),s=new s(c,this),s.initialize(c,r),e.oasis.services.push(s),this.capabilities[r]=s),o=l,this.envPortDefereds[r].resolve(c)}i.log("container: Port created for '"+r+"'"),this.sandboxPortDefereds[r].resolve(o)},this)},destroyChannels:function(){for(var e in this.channels)this.channels[e].destroy(),delete this.channels[e];this.channels=[]},connectPorts:function(){var e=this,t=c.call(this._capabilitiesToConnect,function(t,n){return t.concat(e.sandboxPortDefereds[n].promise)},[]);r.all(t).then(function(t){i.log("container: All "+t.length+" ports created.  Transferring them."),e.adapter.connectPorts(e,t)})["catch"](r.rethrow)},start:function(e){this.adapter.startSandbox(this,e)},terminate:function(){var e=this;if(!this.isTerminated){this.isTerminated=!0,this.adapter.terminateSandbox(this),this.destroyChannels();for(var t=0;t<e.oasis.services.length;t++)e.oasis.services[t].destroy(),delete e.oasis.services[t];e.oasis.services=[]}},onerror:function(e){throw e},name:function(){return this.adapter.name(this)},_filterCapabilities:function(e){return o.call(this.adapter.filterCapabilities(e))},_waitForLoadDeferred:function(){return this._loadDeferred||(this._loadDeferred=r.defer()),this._loadDeferred}},l}),r("oasis/sandbox_init",[],function(){"use strict";function e(){if("undefined"!=typeof window){if(/PhantomJS/.test(navigator.userAgent))return;window.parent&&window.parent!==window&&Oasis.adapters.iframe.connectSandbox(this)}else Oasis.adapters.webworker.connectSandbox(this)}return e}),r("oasis/events",[],function(){"use strict";function e(){this.listenerArrays={}}var t=Array.prototype.slice;return e.prototype={on:function(e,t){var n=this.listenerArrays[e]=this.listenerArrays[e]||[];n.push(t)},off:function(e,t){var n=this.listenerArrays[e];if(n)for(var r=0;r<n.length;++r)if(n[r]===t){n.splice(r,1);break}},clear:function(e){delete this.listenerArrays[e]},trigger:function(e){var n=this.listenerArrays[e];if(n)for(var r=t.call(arguments,1),i=0;i<n.length;++i)n[i].apply(null,r)}},e}),r("oasis/service",["oasis/shims"],function(e){"use strict";function t(e,t){function n(e){return function(){return e.apply(a,arguments)}}var r,i,a=this;this.sandbox=t,this.port=e;for(r in this.events)i=this.events[r],e.on(r,n(i));for(r in this.requests)i=this.requests[r],e.onRequest(r,n(i))}var n=e.o_create;return t.prototype={initialize:function(){},error:function(){},destroy:function(){},send:function(){return this.port.send.apply(this.port,arguments)},request:function(){return this.port.request.apply(this.port,arguments)}},t.extend=function r(e){function t(){t.prototype.init&&t.prototype.init.call(this),i.apply(this,arguments)}var i=this;t.extend=r;var a=t.prototype=n(this.prototype);for(var o in e)a[o]=e[o];return t},t}),r("oasis/base_adapter",["oasis/util","oasis/shims","oasis/connect","oasis/message_channel","rsvp","oasis/logger"],function(e,t,n,r,i,a){"use strict";function o(){this._unsupportedCapabilities=[]}var s=e.mustImplement,u=t.addEventListener,c=t.removeEventListener,d=t.a_indexOf,l=t.a_filter,p=(n.connectCapabilities,r.PostMessageMessageChannel);return o.prototype={initializeSandbox:s("BaseAdapter","initializeSandbox"),name:s("BaseAdapter","name"),unsupportedCapabilities:function(){return this._unsupportedCapabilities},addUnsupportedCapability:function(e){this._unsupportedCapabilities.push(e)},filterCapabilities:function(e){var t=this._unsupportedCapabilities;return l.call(e,function(e){var n=d.call(t,e);return-1===n})},createChannel:function(e){var t=new p(e);return t.port1.start(),t},environmentPort:function(e,t){return t.port1},sandboxPort:function(e,t){return t.port2},proxyPort:function(e,t){return t},connectSandbox:function(e,t){function n(i){i.data.isOasisInitialization&&(c(e,"message",n),r.initializeOasisSandbox(i,t))}var r=this;a.log("Sandbox listening for initialization message"),u(e,"message",n),r.oasisLoaded(t)},initializeOasisSandbox:function(e,t){var n=this;t.configuration.eventCallback(function(){a.log("sandbox: received initialization message."),t.connectCapabilities(e.data.capabilities,e.ports),n.didConnect(t)})},createInitializationMessage:function(e){return{isOasisInitialization:!0,capabilities:e._capabilitiesToConnect}},oasisLoadedMessage:"oasisSandboxLoaded",sandboxInitializedMessage:"oasisSandboxInitialized"},o}),r("oasis/iframe_adapter",["oasis/util","oasis/shims","rsvp","oasis/logger","oasis/base_adapter"],function(t,n,r,i,a){"use strict";function o(e,t){var n,r=document.createElement("iframe");if((e.configuration.allowSameOrigin&&void 0!==r.sandbox||void 0===r.sandbox)&&(n=document.createElement("a"),n.href=t,!n.host||n.protocol===window.location.protocol&&n.host===window.location.host))throw new Error("Security: iFrames from the same host cannot be sandboxed in older browsers and is disallowed.  For HTML5 browsers supporting the `sandbox` attribute on iframes, you can add the `allow-same-origin` flagonly if you host the sandbox on a separate domain.")}function s(e,t){function n(){e.onerror(new Error("Cannot reconnect null origins unless `reconnect` is set to 'any'.  `reconnect: 'verify' requires `allowSameOrigin: true`"))}var r,i;if(e.firstLoad||"any"===e.options.reconnect)return!0;if(e.oasis.configuration.allowSameOrigin&&"null"!==t.origin){if(r=document.createElement("a"),i=document.createElement("a"),r.href=e.options.url,i.href=t.origin,i.protocol===r.protocol&&i.host===r.host)return!0;n()}else n()}var u=(t.assert,t.extend),c=(n.a_forEach,n.addEventListener),d=n.removeEventListener,l=n.a_map,p=u(a,{initializeSandbox:function(t){var n=t.options,a=document.createElement("iframe"),u=["allow-scripts"],l=!n||!n.sandbox||!n.sandbox.disabled;l&&(t.oasis.configuration.allowSameOrigin&&u.push("allow-same-origin"),n&&n.sandbox&&n.sandbox.popups&&u.push("allow-popups")),a.name=t.options.url+"?uuid="+e.generate(),l&&(a.sandbox=u.join(" ")),a.seamless=!0,n.width?a.width=n.width:n.height&&(a.height=n.height),a.errorHandler=function(e){if(e.data.sandboxException){try{if(e.source!==a.contentWindow)return}catch(n){return}t.onerror(e.data.sandboxException)}},c(window,"message",a.errorHandler),l&&o(t.oasis,t.options.url),a.src=t.options.url,i.log("Initializing sandbox "+a.name),t._waitForLoadDeferred().resolve(new r.Promise(function(e,n){a.initializationHandler=function(n){if(n.data===t.adapter.sandboxInitializedMessage){try{if(n.source!==a.contentWindow)return}catch(r){return}d(window,"message",a.initializationHandler),t.oasis.configuration.eventCallback(function(){i.log("container: iframe sandbox has initialized (capabilities connected)"),e(t)})}},c(window,"message",a.initializationHandler)})),t.el=a,a.oasisLoadHandler=function(e){if(e.data===t.adapter.oasisLoadedMessage){try{if(e.source!==a.contentWindow)return}catch(n){return}i.log("container: iframe sandbox has loaded Oasis"),s(t,e)&&t.createAndTransferCapabilities(),"none"===t.options.reconnect&&d(window,"message",a.oasisLoadHandler)}},c(window,"message",a.oasisLoadHandler)},startSandbox:function(e){var t=document.head||document.documentElement.getElementsByTagName("head")[0];t.appendChild(e.el)},terminateSandbox:function(e){var t=e.el;e.terminated=!0,t.loadHandler&&d(t,"load",t.loadHandler),d(window,"message",t.initializationHandler),d(window,"message",t.oasisLoadHandler),t.parentNode&&(i.log("Terminating sandbox ",e.el.name),t.parentNode.removeChild(t)),e.el=null},connectPorts:function(e,t){var n=l.call(t,function(e){return e.port}),r=this.createInitializationMessage(e);e.terminated||Window.postMessage(e.el.contentWindow,r,"*",n)},connectSandbox:function(e){return a.prototype.connectSandbox.call(this,window,e)},oasisLoaded:function(){window.parent.postMessage(this.oasisLoadedMessage,"*",[])},didConnect:function(){window.parent.postMessage(this.sandboxInitializedMessage,"*",[])},name:function(e){return e.el.name}});return p}),r("oasis/webworker_adapter",["oasis/util","oasis/shims","rsvp","oasis/logger","oasis/base_adapter"],function(t,n,r,i,a){"use strict";var o=(t.assert,t.extend),s=(n.a_forEach,n.addEventListener),u=n.removeEventListener,c=o(a,{type:"js",initializeSandbox:function(t){var n=new Worker(t.options.url);n.name=t.options.url+"?uuid="+e.generate(),t.worker=n,n.errorHandler=function(e){e.data.sandboxException&&t.onerror(e.data.sandboxException)},s(n,"message",n.errorHandler),t._waitForLoadDeferred().resolve(new r.Promise(function(e,r){n.initializationHandler=function(r){t.oasis.configuration.eventCallback(function(){r.data===t.adapter.sandboxInitializedMessage&&(u(n,"message",n.initializationHandler),i.log("worker sandbox initialized"),e(t))})},s(n,"message",n.initializationHandler)})),n.loadHandler=function(e){t.oasis.configuration.eventCallback(function(){e.data===t.adapter.oasisLoadedMessage&&(u(n,"message",n.loadHandler),i.log("worker sandbox initialized"),t.createAndTransferCapabilities())})},s(n,"message",n.loadHandler)},startSandbox:function(e){},terminateSandbox:function(e){var t=e.worker;u(t,"message",t.loadHandler),u(t,"message",t.initializationHandler),e.worker.terminate()},connectPorts:function(e,t){var n=t.map(function(e){return e.port}),r=this.createInitializationMessage(e);Worker.postMessage(e.worker,r,n)},connectSandbox:function(e){return a.prototype.connectSandbox.call(this,self,e)},name:function(e){return e.worker.name},oasisLoaded:function(){postMessage(this.oasisLoadedMessage,[])},didConnect:function(){postMessage(this.sandboxInitializedMessage,[])}});return c}),r("oasis/inline_adapter",["oasis/util","oasis/config","oasis/shims","oasis/xhr","rsvp","oasis/logger","oasis/base_adapter"],function(e,t,n,r,i,a,o){"use strict";var s=(e.assert,e.extend),u=e.noop,c=(t.configuration,n.a_forEach,n.a_map),d=r.xhr,l=s(o,{initializeSandbox:function(e){e.el=document.createElement("div");e.sandboxedOasis=new Oasis;e.sandboxedOasis.sandbox=e,i.async(function(){e.createAndTransferCapabilities()})},startSandbox:function(e){var t=document.body||document.documentElement.getElementsByTagName("body")[0];t.appendChild(e.el)},terminateSandbox:function(e){var t=e.el;t.parentNode&&(a.log("Terminating sandbox ",e.el.name),t.parentNode.removeChild(t)),e.el=null},connectPorts:function(e,t){var n=c.call(t,function(e){return e.port}),r=this.createInitializationMessage(e),i={data:r,ports:n};this.connectSandbox(e.sandboxedOasis,i)},fetchResource:function(e,t){var n=this;return d(e,{dataType:"text"},t).then(function(e){return n.wrapResource(e)})["catch"](i.rethrow)},wrapResource:function(e){return new Function("oasis",e)},connectSandbox:function(e,t){return this.initializeOasisSandbox(t,e)},oasisLoaded:u,didConnect:function(e){function t(t){return a.log("sandbox: inline sandbox initialized"),t(e),e.sandbox}function n(){return new i.Promise(function(n,i){n(r.fetchResource(e.sandbox.options.url,e).then(t))})}var r=this;return e.sandbox._waitForLoadDeferred().resolve(n()["catch"](i.rethrow))}});return l}),r("oasis",["require","exports","module","rsvp","oasis/util","oasis/xhr","oasis/connect","oasis/logger","oasis/version","oasis/config","oasis/sandbox","oasis/sandbox_init","oasis/events","oasis/service","oasis/iframe_adapter","oasis/webworker_adapter","oasis/inline_adapter"],function(e,t,n){"use strict";function r(){this.packages={},this.requestId=0,this.oasisId="oasis"+ +new Date,this.consumers={},this.services=[],this.ports={},this.handlers={},this.receivedPorts=!1,this.configuration=new d,this.events=new f,this.didCreate()}e("rsvp");var i=e("oasis/util"),a=e("oasis/xhr"),o=e("oasis/connect"),s=window.RSVP,u=e("oasis/logger"),c=e("oasis/version"),d=e("oasis/config"),l=e("oasis/sandbox"),p=e("oasis/sandbox_init"),f=e("oasis/events"),m=e("oasis/service"),g=e("oasis/iframe_adapter"),h=e("oasis/webworker_adapter"),v=e("oasis/inline_adapter"),y=i.assert,b=i.delegate,w=a.xhr,_=o.connect,C=o.connectCapabilities,E=o.portFor;r.Version=c,r.Service=r.Consumer=m,r.RSVP=s,r.reset=function(){r.adapters={iframe:new g,webworker:new h,inline:new v}},r.reset(),r.prototype={logger:u,log:function(){this.logger.log.apply(this.logger,arguments)},on:b("events","on"),off:b("events","off"),trigger:b("events","trigger"),didCreate:function(){},xhr:w,createSandbox:function(e){return new l(this,e)},register:function(e){y(e.capabilities,"You are trying to register a package without any capabilities. Please provide a list of requested capabilities, or an empty array ([])."),this.packages[e.url]=e},configure:function(e,t){this.configuration[e]=t},autoInitializeSandbox:p,connect:_,connectCapabilities:C,portFor:E},n.exports=r}),r("glympse-adapter/VersionInfo",["require","exports","module"],function(e,t,n){"use strict";n.exports={id:"glympse-adapter",version:"2.13.0",buildDate:"2018-06-29 18:02:08 UTC"}}),r("glympse-adapter/GlympseAdapterDefines",["require","exports","module"],function(e,t,n){"use strict";var r={PORT:"glympse",MAP:{REQUESTS:{addInvites:"addInvites",addGroups:"addGroups",addMarkers:"addMarkers",addTwitterTopics:"addTwitterTopics",addTwitterUsers:"addTwitterUsers",refreshView:"refreshView",removeInvites:"removeInvites",setApiServices:"setApiServices",setPadding:"setPadding",setUserInfo:"setUserInfo",updateSetting:"updateSetting"},REQUESTS_LOCAL:{getInvites:"getInvites",getMap:"getMap",getMapContainer:"getMapContainer",generateRoute:"generateRoute",ignoreDestinations:"ignoreDestinations"}},CARDS:{REQUESTS:{requestCards:"requestCards",request:"request",joinRequest:"joinRequest",joinRequestCancel:"joinRequestCancel",getActiveJoinRequests:"getActiveJoinRequests",removeMember:"removeMember",activity:"activity"},REQUESTS_LOCAL:{getCards:"getCards"},REQUEST_TYPES:{LINK:"link",CLIPBOARD:"clipboard",SMS:"sms",EMAIL:"email",ACCOUNT:"account"}},CORE:{REQUESTS:{addGroup:"addGroup",getGroups:"getGroups",removeGroup:"removeGroup",getOrgObjects:"getOrgObjects",getEtaInfo:"getEtaInfo",getInviteEta:"getInviteEta"},REQUESTS_LOCAL:{accountCreate:"accountCreate",accountDelete:"accountDelete",generateAuthToken:"generateAuthToken",getUserInfo:"getUserInfo",setUserName:"setUserName",setUserAvatar:"setUserAvatar",hasAccount:"hasAccount",createRequest:"createRequest"}},MSG:{AccountCreateStatus:"AccountCreateStatus",AccountDeleteStatus:"AccountDeleteStatus",AccountLoginStatus:"AccountLoginStatus",UserNameUpdateStatus:"UserNameUpdateStatus",UserAvatarUpdateStatus:"UserAvatarUpdateStatus",UserInfoStatus:"UserInfoStatus",CreateRequestStatus:"CreateRequestStatus",AdapterInit:"AdapterInit",AdapterReady:"AdapterReady",CardInit:"CardInit",CardReady:"CardReady",CardsInitEnd:"CardsInitEnd",CardsInitStart:"CardsInitStart",CardUpdated:"CardUpdated",CardAdded:"CardAdded",CardRemoved:"CardRemoved",CardsRequestStatus:"CardsRequestStatus",CardsJoinRequestStatus:"CardsJoinRequestStatus",CardsJoinRequestCancelStatus:"CardsJoinRequestCancelStatus",CardActivityStatus:"CardActivityStatus",CardsActiveJoinRequestsStatus:"CardsActiveJoinRequestsStatus",CardRemoveMemberStatus:"CardRemoveMemberStatus",CardsLocationRequestStatus:"CardsLocationRequestStatus",GroupLoaded:"GroupLoaded",GroupStatus:"GroupStatus",OrgObjects:"OrgObjects",EtaInfo:"EtaInfo",InviteEta:"InviteEta",DataUpdate:"DataUpdate",InviteAdded:"InviteAdded",InviteClicked:"InviteClicked",InviteError:"InviteError",InviteInit:"InviteInit",InviteReady:"InviteReady",InviteRemoved:"InviteRemoved",OauthError:"OauthError",Progress:"Progress",StateUpdate:"StateUpdate",ViewerInit:"ViewerInit",ViewerReady:"ViewerReady",ViewerZoomChanged:"ViewerZoomChanged"},STATE:{Avatar:"avatar",Destination:"destination",Eta:"eta",InviteEnd:"end_time",InviteCompleted:"completed",InviteStart:"start_time",Message:"message",Name:"name",Owner:"owner",Phase:"phase",Arrived:"Arrived",Expired:"Expired",NoInvites:"NoInvites",App:"app"}};!function(e){var t=e.glympse||{};t.broadcastTypes||(t.broadcastTypes={DATA:"DATA",ETA:"ETA",INVITE_STATUS:"INVITE_STATUS",ZOOM:"ZOOM"}),t.GlympseAdapterDefines||(t.GlympseAdapterDefines=r),e.glympse=t}(window),n.exports=r}),r("glympse-adapter/lib/rafUtils",["require","exports","module"],function(e,t,n){function r(e,t){function n(t){return a.cancel?void 0:(l||(t=(new Date).getTime()),t>=o?void e.call():void(a.raf=i(n)))}if(!d){d=!0;var r=c&&c.syncRAF;r&&r()}var i=s.requestAnimationFrame;if(!i||!s.cancelAnimationFrame)return s.setTimeout(e,t);var a={},o=(l&&l.now()||(new Date).getTime())+t;return a.raf=i(n),a}function i(e){e&&e.raf?(e.cancel=!0,s.cancelAnimationFrame(e.raf)):s.clearTimeout(e)}function a(e,t,n){function r(i){return n.cancel?void 0:i>=u?(e.call(),void a(e,t,n)):void(n.raf=o(r))}if(!d){d=!0;var i=c&&c.syncRAF;i&&i()}var o=s.requestAnimationFrame;if(!o||!s.cancelAnimationFrame)return s.setInterval(e,t);var u=(l&&l.now()||(new Date).getTime())+t;return n=n||{},n.raf=o(r),n}function o(e){e&&e.raf?(e.cancel=!0,s.cancelAnimationFrame(e.raf)):s.clearInterval(e)}var s=window,u=s.glympse,c=u&&u.lib,d=!1,l=s.performance;n.exports={setTimeout:r,clearTimeout:i,setInterval:a,clearInterval:o}}),r("glympse-adapter/adapter/ViewerMonitor",["require","exports","module","glympse-adapter/GlympseAdapterDefines","glympse-adapter/lib/utils","glympse-adapter/lib/rafUtils"],function(e,t,n){"use strict";function r(e,t){function n(t){C.removeEventListener(E.INIT,n,!1),e.notify(s.ViewerInit,!0)}function i(t){if(C.removeEventListener(E.READY,i,!1),_=t.detail.app,!_)return void T("Error getting viewer. Aborting!");for(var n=0;n<A.length;n++){var r=A[n];I.cmd(r.cmd,r.args)}e.notify(s.ViewerReady,_);var a=_.getInvites();a&&0!==a.length||e.infoUpdate(u.NoInvites,null,null,(new Date).getTime(),!0)}function p(t){var n,r,i,o,c,d=t.detail,l=d.id&&a.simplifyInvite(d.id),p=[],f=d.data||[],m=d.owner,g=[];for(n=0,r=f.length;r>n;n++)i=f[n],o=i.n,c=g.indexOf(o),-1!==c&&(g.splice(c,1),p.splice(c,1),T("> Cleaned-up outdated prop:"+o)),g.push(o),p.push($.extend({},f[n]));var h=[];x[l]||(x[l]={_timer:0});var v=x[l];for(n=0,r=p.length;r>n;n++){for(var y=p[n],b=y.v,_=y.n,C=y.t,E=!1,I=0,A=S.length;A>I;I++){var k=S[I];if(_===k&&(E=!0,v[k]!==b)){y.n=void 0,v[k]=y,k===u.Destination&&(b.lat="function"==typeof b.lat?b.lat():b.lat,b.lng="function"==typeof b.lng?b.lng():b.lng),e.infoUpdate(k,l,m,C,b);break}}_===u.InviteEnd&&w(l,m),E||(h.push(y),y=$.extend({},y),y.n=void 0,v[_]=y)}h.length>0&&(d.data=h,e.notify(s.DataUpdate,d))}function f(t){var n=t.detail,r=(new Date).getTime(),i=u.Eta,o=a.simplifyInvite(n.id),s=x[o],c=s[i];c||(c={},s[i]=c),c[d]=1e3*n.data,c[l]=r,e.infoUpdate(i,o,n.owner,r,c)}function m(t){t.detail.data=void 0,e.notify(s.InviteAdded,t.detail)}function g(t){var n=t&&t.detail||{},r=n.id;if(r){var i=x[r];i&&i._timer&&o.clearTimeout(i._timer),delete x[r]}n.data=void 0,e.notify(s.InviteRemoved,n)}function h(t){t.detail.data=void 0,e.notify(s.InviteClicked,t.detail)}function v(t){e.notify(s.InviteError,t.detail)}function y(t){e.notify(s.OauthError,t.detail)}function b(t){e.notify(s.ViewerZoomChanged,t.detail)}function w(t,n){var r=x[t];if(r){r._timer&&(o.clearTimeout(r._timer),r._timer=0);var i=(new Date).getTime(),a=u.Expired.toLowerCase(),s=r[u.InviteEnd].v,c=r[a],d=i>=s;return c||(c={t:i,v:d},r[a]=c),c.v=d,d?void e.infoUpdate(u.Expired,t,n,i,d):void(r._timer=o.setTimeout(function(){w(t,n)},s-i+1e3))}}var _,C,E=window.glympse.events,S=[u.Avatar,u.Destination,u.InviteStart,u.InviteEnd,u.Eta,u.Message,u.Name,u.Phase,u.Expired,u.App],I=this,A=[],x={},T=a.dbg("MapController",t.dbg);this.run=function(){return t.viewer?(C=t.viewer,C.addEventListener(E.INIT,n,!1),C.addEventListener(E.READY,i,!1),C.addEventListener(E.DATA,p,!1),C.addEventListener(E.PROPERTIES,p,!1),C.addEventListener(E.ETA,f,!1),C.addEventListener(E.INVITE_ADDED,m,!1),C.addEventListener(E.INVITE_REMOVED,g,!1),C.addEventListener(E.INVITE_CLICKED,h,!1),C.addEventListener(E.INVITE_ERROR,v,!1),C.addEventListener(E.OAUTH_TOKEN_ERROR,y,!1),void C.addEventListener(E.ZOOM_CHANGED,b,!1)):void T("No viewer set. Aborting...")},this.shutdown=function(){C.removeEventListener(E.DATA,p,!1),C.removeEventListener(E.PROPERTIES,p,!1),C.removeEventListener(E.ETA,f,!1)},this.getCurrentProperties=function(e){if(e=e&&a.simplifyInvite(e),!e)for(e in x)if(e)break;return x.hasOwnProperty(e)?x[e]:'Unknown invite "'+e+'"'},this.getCurrentValue=function(e,t){var n=this.getCurrentProperties(t);return"string"==typeof n?n:e&&n.hasOwnProperty(e)?n[e]:'Unknown property id "'+e+'" for invite "'+t+'"'},this.cmd=function(e,t){if(!_)return A.push({cmd:e,args:t}),null;switch(e){case r.GetInviteProperties:return this.getCurrentProperties(t);case r.GetInviteProperty:return this.getCurrentValue(t.idProperty,t.idInvite);case c.setPadding:if(!(t instanceof Array)){if("number"!=typeof t)return"Invalid paddingArray type!";t=[null,null,null,t]}}return _[e](t)}}var i=e("glympse-adapter/GlympseAdapterDefines"),a=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/lib/rafUtils"),s=i.MSG,u=i.STATE,c=i.MAP.REQUESTS,d="eta",l="eta_ts";r.GetInviteProperties="getInviteProperties",r.GetInviteProperty="getInviteProperty",n.exports=r}),r("glympse-adapter/lib/ajax",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t,n){e?n.headers.Authorization=e+t:n.url+=(n.url.indexOf("?")<0?"?":"&")+"oauth_token="+t}function i(e){var t=null;if(e&&(e.response||e.body)&&(t={status:!1,response:{}},"ok"===e.result&&(t.status=!0,t.response=e.response||e.body,t.time=e.meta&&e.meta.time),"failure"===e.result)){var n=e.meta||{};t.response=n,t.error=n.error,t.errorDetail=n.error_detail}return t}function a(e){var t=this;return function(n){t.attempts--;var r=i(n);if(r){if(-1!==["oauth_token","token_expired","access_denied"].indexOf(r.error)){if(e)return console.warn("[ajax] token error for authorized API request"),void e.generateToken(function(e){e.status?t.retry&&t.retry():(r.authResult=e,t.request.resolve(r))});console.warn("[ajax] token error for public API request"),r.invalidToken=!0}return void t.request.resolve(r)}if(r={status:!1},t.retry&&t.attempts>0){var a=o-t.attempts;return setTimeout(function(){t.retry()},a*(500+Math.round(1e3*Math.random()))),r.info={attempt:a,result:n},void t.request.notify(r)}r.info={status:"max_attempts",lastResult:n},r.error="Still failing after "+o+" attempts",t.request.resolve(r)}}var o=(e("glympse-adapter/lib/utils"),3),s={ALL:{dataType:"json"},POST:{contentType:"application/json"}},u={requestHeaders:{},makeRequest:function(e,t,n){var i,u,c,d=$.extend({},s.ALL,e);t&&(t.account?(i=t.account,u=t.useHeader!==!1):(i=t,u=!0),u&&(c=t.useGlympseAuthHeader===!0?"Glympse ":"Bearer ")),d.headers=$.extend({},d.headers,this.requestHeaders);
var l={request:$.Deferred(),attempts:n===!1?1:o,retry:function(){var e=i&&i.getToken();e&&r(c,e,d),$.ajax(d).always(a.call(l,i))}};return!i||i.getToken()?l.retry():i.generateToken(function(e){e.status?l.retry():l.request.resolve(e)}),l.request},get:function(e,t,n,r,i){return u.makeRequest($.extend({url:e,type:"GET",data:t},r),n,i)},post:function(e,t,n,r,i){var a=$.extend({url:e,type:"POST"},s.POST,r);return t&&("application/json"===a.contentType&&(t=JSON.stringify(t)),a.data=t),u.makeRequest(a,n,i)},"delete":function(e,t,n,r){return u.makeRequest($.extend({url:e,type:"DELETE"},s.POST,n),t,r)},batch:function(e,t,n,r,a){return u.post(e,t,n,r,a).then(function(e){var n,r,a,o=[];if(e.status){var s=e.response.items||[];for(n=0,r=s.length;r>n;n++)a=i(s[n].body),a.time=e.time,o.push({name:s[n].name,result:a})}else for(n=0,r=t.length;r>n;n++){var u=t[n];o.push({name:u.name,result:e})}return o})}};n.exports=u}),r("glympse-adapter/lib/image",["require","exports","module"],function(e,t,n){function r(e){var t="",n=new DataView(e,0,5),r=n.getUint8(0,!0),i=n.getUint8(1,!0),a=r.toString(16)+i.toString(16);switch(a){case"8950":t="image/png";break;case"4749":t="image/gif";break;case"424d":t="image/bmp";break;case"ffd8":t="image/jpeg";break;default:t=null}return t}var i={imageScale:function(e,t,n){function r(e){var r,i,a,o,s=e.width,u=e.height,c=0,d=0,l=t.maintainAspectRatio,p=[s,u];p[0]>=p[1]?(p[0]>t.maxSize[0]&&(p[0]=t.maxSize[0],p[1]=u*t.maxSize[0]/s),p[0]<t.minSize[0]&&(p[0]=t.minSize[0],p[1]=u*t.minSize[0]/s)):(p[1]>t.maxSize[1]&&(p[0]=s*t.maxSize[1]/u,p[1]=t.maxSize[1]),p[1]<t.minSize[1]&&(p[0]=s*t.minSize[1]/u,p[1]=t.minSize[1])),p[0]!==p[1]&&(p[0]=Math.max(p[0],p[1]),p[1]=Math.max(p[0],p[1]));var f=document.createElement("canvas");f.id="glympse-adapter-image-processing",f.width=p[0],f.height=p[1],document.body.appendChild(f);var m=f.getContext("2d");m.fillStyle=t.convertAlpha||"#FFFFFF",m.fillRect(0,0,f.width,f.height),r=s/p[0],i=u/p[1],l&&(r=Math.max(r,i),i=Math.max(r,i)),a=s/r,o=u/i,c=(f.width-a)/2,d=(f.height-o)/2,m.fillStyle=t.sidebandFill||"#FFFFFF",m.fillRect(0,0,c,f.height),m.fillRect(c+a,0,f.width,f.height),m.fillRect(0,0,f.width,d),m.fillRect(0,d+o,f.width,f.height),m.drawImage(e.img,c,d,a,o);for(var g=f.toDataURL("image/jpeg"),h=atob(g.split(",")[1]),v=new ArrayBuffer(h.length),y=new Uint8Array(v),b=0;b<h.length;b++)y[b]=h.charCodeAt(b);n(v),f.remove()}this.imageInfo(e,r)},imageInfo:function(e,t){var n=new Blob([e],{type:"image/jpeg"}),i=window.URL||window.webkitURL,a=i.createObjectURL(n),o=new Image;o.src=a,o.onload=function(){t({width:$(o).width(),height:$(o).height(),type:r(e),img:o}),o.remove()},o.onerror=function(){o.remove()},document.body.appendChild(o)},loadDataArrayByUrl:function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.setRequestHeader("x-force-header","true"),n.onload=function(){var e=n.response;e&&t(e)},n.onerror=function(e){var n={status:!1,errorDetail:"Could not load image by url",response:e};t(null,n)},n.send(null)}};n.exports=i}),function(e){"use strict";function t(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function n(e,t){return e<<t|e>>>32-t}function i(e,r,i,a,o,s){return t(n(t(t(r,e),t(a,s)),o),i)}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function u(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}function c(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var r,i,c,d,l,p=1732584193,f=-271733879,m=-1732584194,g=271733878;for(r=0;r<e.length;r+=16)i=p,c=f,d=m,l=g,p=a(p,f,m,g,e[r],7,-680876936),g=a(g,p,f,m,e[r+1],12,-389564586),m=a(m,g,p,f,e[r+2],17,606105819),f=a(f,m,g,p,e[r+3],22,-1044525330),p=a(p,f,m,g,e[r+4],7,-176418897),g=a(g,p,f,m,e[r+5],12,1200080426),m=a(m,g,p,f,e[r+6],17,-1473231341),f=a(f,m,g,p,e[r+7],22,-45705983),p=a(p,f,m,g,e[r+8],7,1770035416),g=a(g,p,f,m,e[r+9],12,-1958414417),m=a(m,g,p,f,e[r+10],17,-42063),f=a(f,m,g,p,e[r+11],22,-1990404162),p=a(p,f,m,g,e[r+12],7,1804603682),g=a(g,p,f,m,e[r+13],12,-40341101),m=a(m,g,p,f,e[r+14],17,-1502002290),f=a(f,m,g,p,e[r+15],22,1236535329),p=o(p,f,m,g,e[r+1],5,-165796510),g=o(g,p,f,m,e[r+6],9,-1069501632),m=o(m,g,p,f,e[r+11],14,643717713),f=o(f,m,g,p,e[r],20,-373897302),p=o(p,f,m,g,e[r+5],5,-701558691),g=o(g,p,f,m,e[r+10],9,38016083),m=o(m,g,p,f,e[r+15],14,-660478335),f=o(f,m,g,p,e[r+4],20,-405537848),p=o(p,f,m,g,e[r+9],5,568446438),g=o(g,p,f,m,e[r+14],9,-1019803690),m=o(m,g,p,f,e[r+3],14,-187363961),f=o(f,m,g,p,e[r+8],20,1163531501),p=o(p,f,m,g,e[r+13],5,-1444681467),g=o(g,p,f,m,e[r+2],9,-51403784),m=o(m,g,p,f,e[r+7],14,1735328473),f=o(f,m,g,p,e[r+12],20,-1926607734),p=s(p,f,m,g,e[r+5],4,-378558),g=s(g,p,f,m,e[r+8],11,-2022574463),m=s(m,g,p,f,e[r+11],16,1839030562),f=s(f,m,g,p,e[r+14],23,-35309556),p=s(p,f,m,g,e[r+1],4,-1530992060),g=s(g,p,f,m,e[r+4],11,1272893353),m=s(m,g,p,f,e[r+7],16,-155497632),f=s(f,m,g,p,e[r+10],23,-1094730640),p=s(p,f,m,g,e[r+13],4,681279174),g=s(g,p,f,m,e[r],11,-358537222),m=s(m,g,p,f,e[r+3],16,-722521979),f=s(f,m,g,p,e[r+6],23,76029189),p=s(p,f,m,g,e[r+9],4,-640364487),g=s(g,p,f,m,e[r+12],11,-421815835),m=s(m,g,p,f,e[r+15],16,530742520),f=s(f,m,g,p,e[r+2],23,-995338651),p=u(p,f,m,g,e[r],6,-198630844),g=u(g,p,f,m,e[r+7],10,1126891415),m=u(m,g,p,f,e[r+14],15,-1416354905),f=u(f,m,g,p,e[r+5],21,-57434055),p=u(p,f,m,g,e[r+12],6,1700485571),g=u(g,p,f,m,e[r+3],10,-1894986606),m=u(m,g,p,f,e[r+10],15,-1051523),f=u(f,m,g,p,e[r+1],21,-2054922799),p=u(p,f,m,g,e[r+8],6,1873313359),g=u(g,p,f,m,e[r+15],10,-30611744),m=u(m,g,p,f,e[r+6],15,-1560198380),f=u(f,m,g,p,e[r+13],21,1309151649),p=u(p,f,m,g,e[r+4],6,-145523070),g=u(g,p,f,m,e[r+11],10,-1120210379),m=u(m,g,p,f,e[r+2],15,718787259),f=u(f,m,g,p,e[r+9],21,-343485551),p=t(p,i),f=t(f,c),m=t(m,d),g=t(g,l);return[p,f,m,g]}function d(e){var t,n="",r=32*e.length;for(t=0;r>t;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;r>t;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function p(e){return d(c(l(e),8*e.length))}function f(e){var t,n,r="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function m(e){return unescape(encodeURIComponent(e))}function g(e){return p(m(e))}function h(e){return f(g(e))}function v(e){return h(e)}if("function"==typeof r&&r.amd)r("glympse-adapter/lib/md5",[],function(){return v});else if("object"==typeof module&&module.exports)module.exports=v;else{var y=e.glympse||(e.glympse={}),b=y.lib||(y.lib={});b.md5=v}}(window),r("glympse-adapter/adapter/models/Account",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/ajax","glympse-adapter/GlympseAdapterDefines","glympse-adapter/lib/image","glympse-adapter/lib/md5"],function(e,t,n){"use strict";function r(e,t){function n(){T[M]=k,x[U]=T,i.setCfgVal(p,x)}function o(){x=i.getCfgVal(p)||{},T=x[U]||{},k=T[L],k?(R(".. migrating old settings .."),delete T[L],n()):k=T[M]||{}}function C(){o(),k={},n()}function E(t){z||(z=a.get(N,P).then(function(t){return t.status&&(A=t.response.access_token,k[l]=A,n(),t.id=P[v],t.token=A),e.notify(c.AccountLoginStatus,t),z=null,t})),t&&z.then(function(e){t(e)})}function S(t,n){var r=O+"users/"+(t||"self");a.get(r,null,G).then(function(r){r.status&&(r.response.userId=t),n?e.notify(c.AccountLoginStatus,{status:!0,token:A,id:k[g]}):e.notify(c.UserInfoStatus,r)})}function I(){var t={};t[f]=P[f],a.get(j,t).then(function(t){if(t.status){var r=t.response,i=r.id,a=r.password;P[v]=i,P[h]=a,k[g]=i,k[m]=a,n()}e.notify(c.AccountCreateStatus,t)})}var A,x,T,k,R=i.dbg("Account",t.dbg),O=t.svcGlympse,D=t.sandbox,U=D?r[b]:r[y],P={},L=t.apiKey,M=u(L),j=O+"account/create",N=O+"account/login",q=t.isAnon,G=this,z=null;P[f]=L,this.getToken=function(){return A},this.getId=function(){return P[v]},this.init=function(){if(o(),q)P[v]=w,P[h]=_;else{var t=k[g],n=k[m];if(!t||!n)return e.notify(c.AccountLoginStatus,{status:!1,error:"no_account",errorDetail:"No account exists for the current apiKey."}),!1;P[v]=t,P[h]=n}return(A=k[l])?(q?e.notify(c.AccountLoginStatus,{status:!0,token:A,anonymous:!0}):S(null,!0),!0):(E(),!1)},this.generateToken=function(e){A=null,E(e)},this.create=function(){q?R("Creating account failed, no API key available"):I()},this.setName=function(t){var n=O+"users/self/update";a.get(n,{name:t},G).then(function(t){e.notify(c.UserNameUpdateStatus,t)})},this.setAvatar=function(n){function r(t,n){t?o.setAvatar(t):e.notify(c.UserAvatarUpdateStatus,n)}function i(t){var n=O+"users/self/upload_avatar";a.post(n,new Uint8Array(t),o,{contentType:"image/jpeg",processData:!1}).then(function(t){e.notify(c.UserAvatarUpdateStatus,t)})}var o=this,u=t.avatar||{};if("string"==typeof n)return s.loadDataArrayByUrl(n,r),!1;var d={minSize:[u.minSize||120,u.minSize||120],maxSize:[u.maxSize||512,u.maxSize||512],maintainAspectRatio:!0,sidebandFill:"#fff",convertAlpha:"#fff"};s.imageScale(n,d,i)},this.getUserInfo=S,this.hasAccount=function(){return o(),!(q||!k[g]||!k[m])},this.createRequest=function(t){if(!t||!t.type||t.type!==d.LINK){var n='"type" must be provided (NOTE: only Defines.CARDS.REQUEST_TYPES.LINK type is supported for now)';return R(n,t,3),void e.notify(c.CreateRequestStatus,{status:!1,response:{error:n}})}var r=O+"users/self/create_request?"+$.param(t);a.post(r,null,G).then(function(t){e.notify(c.CreateRequestStatus,t)})},this["delete"]=function(){C(),e.notify(c.AccountDeleteStatus,{status:!0})}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/lib/ajax"),o=e("glympse-adapter/GlympseAdapterDefines"),s=e("glympse-adapter/lib/image"),u=e("glympse-adapter/lib/md5"),c=o.MSG,d=o.CARDS.REQUEST_TYPES,l="t0",p="accountInfo",f="api_key",m="p0",g="n0",h="password",v="username",y="EnvProd",b="EnvSandbox",w="viewer",_="password";r[y]="prod",r[b]="sbox",n.exports=r}),r("glympse-adapter/adapter/models/MemberInvite",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){var n=(i.dbg("MemberInvite",t.dbg),["locale","type","send","invite_code","address"]);this.getData=function(){return e},this.setData=function(t){e=t,i.mapProps(this,n,e)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils");n.exports=r}),r("glympse-adapter/adapter/models/MemberPermissions",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){var n=(i.dbg("MemberTicket",t.dbg),[]);this.getData=function(){return e},this.setData=function(t){e=t,i.mapProps(this,n,e)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils");n.exports=r}),r("glympse-adapter/adapter/models/MemberTicket",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){var n=(i.dbg("MemberTicket",t.dbg),["invite_code","ticket_id","created_time"]);this.getData=function(){return e},this.setData=function(t){e=t,i.mapProps(this,n,e)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils");n.exports=r}),r("glympse-adapter/adapter/models/Member",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/adapter/models/MemberInvite","glympse-adapter/adapter/models/MemberPermissions","glympse-adapter/adapter/models/MemberTicket"],function(e,t,n){"use strict";function r(e,t){var n,r,u,c=(i.dbg("Member",t.dbg),["status","card_id","alias","last_modified","created_time","id","user_id","inviter"]);this.getInvite=function(){return n},this.getPermissions=function(){return r},this.getTicket=function(){return u},this.getMetaData=function(){return e.metadata},this.getData=function(){return e},this.setData=function(d){$.extend(e,d),i.mapProps(this,c,e),e.invite&&(n=new a(e.invite,t)),e.ticket&&(u=new s(e.ticket,t)),e.permissions&&(r=new o(e.permissions,t))},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/adapter/models/MemberInvite"),o=e("glympse-adapter/adapter/models/MemberPermissions"),s=e("glympse-adapter/adapter/models/MemberTicket");n.exports=r}),r("glympse-adapter/adapter/models/Card",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/ajax","glympse-adapter/adapter/models/Member","glympse-adapter/GlympseAdapterDefines"],function(e,t,n){"use strict";function r(e,t,n,r){function s(e){var t=new o(e,r);return S[e.id]=E.length,E.push(t),t}function c(e){var t=S[e];return t>=0?E[t]:null}function d(e){var t,n=S[e];if("undefined"==typeof n)return R("!!! no member to delete",e,3),null;delete S[e],t=E.splice(n,1)[0];for(var r=n,i=E.length;i>r;r++)S[E[r].getId()]=r;return t||null}function l(e){var t=p(e);return t&&!y(t)?m(t):t}function p(e){if(!e)return void R("!!! can't get invite: no member provided",e,3);var t=e.getTicket();return t&&t.getInviteCode()}function f(e){var t=p(e);return t&&y(t)?g(t):void 0}function m(e){return y(e)?e:(A[e]=I.length,I.push(e),e)}function g(e){var t,n=A[e];if("undefined"==typeof n)return R("!!! no invite to delete",e,3),null;delete A[e],t=I.splice(n,1)[0];for(var r=n,i=I.length;i>r;r++)A[I[r]]=r;return t||null}function h(e){var t=e;return T[e.id]=x.length,x.push(t),t}function v(e){var t,n=T[e];if("undefined"==typeof n)return R("!!! no join invite to delete",e,3),null;delete T[e],t=x.splice(n,1)[0];for(var r=n,i=x.length;i>r;r++)T[x[r]]=r;return t||null}function y(e){return"undefined"!=typeof A[e]}var b,w,_=r.svcGlympse,C=!1,E=[],S={},I=[],A={},x=[],T={},k=this,R=i.dbg("Card",r.dbg),O=["name","type_id","last_modified","created_time","id","metadata_etag","inviter","invitee","details"];this.getMembers=function(){return E},this.getMemberById=function(e){return c(e)},this.getMetaData=function(){return b.metadata},this.isLoaded=function(){return C},this.getIdCard=function(){return t},this.getData=function(){return b},this.setData=function(t){C=!0,b=t,i.mapProps(this,O,b);for(var n,r,a=b.members||[],o=0,c=a.length;c>o;o++){n=a[o],r=s(n),e.notify(u.CardUpdated,{card:k,action:"member_added",member:r});var d=l(r);d&&e.notify(u.CardUpdated,{card:k,action:"invite_code_found",invite:d})}R('Card "'+this.getName()+'" ready with '+E.length+" members")},this.setDataFromStream=function(t,r){function i(t){var n;t.status?(n=c(t.response.id),n?n.setData(t.response):n=s(t.response),e.notify(u.CardUpdated,{card:k,action:"member_added",member:n}),l(n)):e.notify(u.CardUpdated,t)}function o(t){var n;t.status?(n=h(t.response),m.invite=n,e.notify(u.CardUpdated,{card:k,action:"invite_added",invite:n})):e.notify(u.CardUpdated,t)}var m,g,y,b,w,C,E,S,I=this.getIdCard(),A=[],x=[],T={},R=[];for(b=0,w=t.length;w>b;b++){g=t[b];var O=g.type;if("member_started_sharing"===O){var D=T[O];C=g.data.member_id||g.member_id,D?(E=D[C],E?E.last_modified<g.last_modified&&(D[C]=g):D[C]=g):(S={},S[C]=g,T[g.type]=S)}else R.push(g)}for(b in T){S=T[b];for(C in S)R.push(S[C])}for(b=0,w=R.length;w>b;b++)switch(g=R[b],m={card:this,action:g.type,t:r},g.type){case"member_added":A.push(g.data.member_id);break;case"member_removed":y=d(g.data?g.data.member_id:g.member_id),m.member=y,m.userId=g.data?g.data.user_id:g.user_id,e.notify(u.CardUpdated,m);break;case"invite_added":x.push(g.data.invite_id);break;case"invite_removed":m.invite=v(g.data.invite_id),e.notify(u.CardUpdated,m);break;case"member_started_sharing":y=c(g.member_id),y?(f(y),y.setData(g.data)):y=s($.extend({id:g.member_id},g.data)),m.invite=l(y),m.userId=g.user_id,e.notify(u.CardUpdated,m);break;case"member_stopped_sharing":y=c(g.member_id),m.invite=p(y),m.userId=g.user_id,e.notify(u.CardUpdated,m);break;case"card_modified":this.dirty=!0,e.notify(u.CardUpdated,m);break;default:m.data=g,e.notify(u.CardUpdated,m)}var U=[];for(b=0,w=A.length;w>b;b++)U.push({name:"members",url:"cards/"+I+"/members/"+A[b],method:"GET"});for(b=0,w=x.length;w>b;b++)U.push({name:"invites",url:"cards/"+I+"/invites/"+x[b],method:"GET"});U.length&&a.batch(_+"batch",U,n).then(function(e){var t;for(b=0,w=e.length;w>b;b++)switch(t=e[b],t.name){case"invites":o(t.result);break;case"members":i(t.result)}})},this.getInvites=function(){return I},this.setLastUpdatingTime=function(e){w=e},this.getLastUpdatingTime=function(){return w},this.toJSON=function(){return b}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/lib/ajax"),o=e("glympse-adapter/adapter/models/Member"),s=e("glympse-adapter/GlympseAdapterDefines"),u=s.MSG;n.exports=r}),r("glympse-adapter/adapter/CardsController",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/rafUtils","glympse-adapter/lib/ajax","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/models/Account","glympse-adapter/adapter/models/Card"],function(e,t,n){"use strict";function r(e,t){function n(n){var r="[accountInitComplete] - ";return q?N?(D(r+"["+(t.isAnon?"ANON":"ACCT")+"] Authenticated. Loading "+k.length+" cards..."),f(k),k.length||e.notify(u.CardsInitEnd,[]),void(L&&t.isAnon?g(k[0]):(T&&a.clearInterval(T),m(),T=a.setInterval(m,P)))):void D(r+"not initialized",n):void D(r+"authToken unavailable",n)}function r(){q=null,T&&(a.clearInterval(T),T=null)}function s(e,t){return{card:e,request:t?v(e):y(e)}}function f(e){if(e&&e.length){var n,r,i,a,u=[],c=[];j=e.length;for(var d=0,l=e.length;l>d;d++)a=e[d],i=O[a],r=!1,i||(i=new p(M,a,q,t),O[a]=i,r=!0),n=s(i,r),u.push(n.request),c.push(n.card),i.dirty&&(n=s(i,!0),u.push(n.request),c.push(n.card));o.batch(U+"batch",u,q).then(function(e){var t,n,r,i;for(n=0,r=e.length;r>n;n++)switch(t=e[n],i=c[n],t.name){case"getCard":b(t.result,i);break;case"updateCard":_(t.result,i)}})}}function m(){o.get(U+"cards",null,q).then(function(t){if(t.status){var n,r,i,a,o=[];for(n=0,i=t.response.length;i>n;n++)r=t.response[n],o.push(r.id),-1===k.indexOf(r.id)&&k.push(r.id);for(n=k.length;n--;)a=k[n],-1===o.indexOf(a)&&(k.splice(n,1),r=O[a],R.splice(R.indexOf(r),1),delete O[a],e.notify(u.CardRemoved,r));f(k)}e.notify(u.CardsRequestStatus,t)})}function g(n){o.get(U+"cards/invites/"+n,null,q).then(function(r){if(r.status){var i=new p(M,n,q,t);O[n]=i,b(r,i),r.response=[r.response]}e.notify(u.CardsRequestStatus,r)})}function h(){return R}function v(t){var n=t.getIdCard();e.notify(u.CardInit,n);var r="cards/"+n;return{name:"getCard",url:r+"?"+$.param({members:!t.dirty}),method:"GET"}}function y(e,t,n){var r=e.getIdCard(),i="cards/"+r+"/activity",a={from_ts:e.getLastUpdatingTime()};return t&&(a.from_ts=t),n&&(a.to_ts=n),{name:"updateCard",url:i+"?"+$.param(a),method:"GET"}}function b(e,t){var n=t.getIdCard();e.status?(G=!0,t.setData(e.response),t.dirty?t.dirty=!1:(t.setLastUpdatingTime(e.time),M.notify(u.CardReady,n)),G&&w()):"failed_to_decode"===e.response.error&&M.notify(u.CardReady,n)}function w(){G=!1;for(var e=0,t=z.length;t>e;e++)M.notify(u.CardUpdated,z[e])}function _(e,t){e.status&&(e.response.length&&t.setDataFromStream(e.response,e.time),t.setLastUpdatingTime(e.time))}function C(t){if(!t||!t.cardId||!t.inviteCode){var n="cardId & inviteCode config params must be passed";return D(n,t,3),void e.notify(u.CardsLocationRequestStatus,{status:!1,response:{error:n}})}var r=U+"cards/"+t.cardId+"/request",i={invite_code:t.inviteCode,invitees:{}};if(t.memberList&&t.memberList.length){for(var a=[],s=0,c=t.memberList.length;c>s;s++)a.push({member_id:t.memberList[s]});i.invitees.type="list",i.invitees.list=a}else i.invitees.type="all";o.post(r,i,q).then(function(t){e.notify(u.CardsLocationRequestStatus,t)})}function E(t){var n=U+"cards/requests";if(!t.type||!t.address&&t.type!==l.CLIPBOARD&&t.type!==l.LINK){var r="Need to provide type (Defines.CARDS.REQUEST_TYPES: LINK, CLIPBOARD, SMS, EMAIL, ACCOUNT) and address (except LINK and CLIPBOARD types) to join a card";return D(r,t,3),void e.notify(u.CardsJoinRequestStatus,{status:!1,response:{error:r}})}t.send=t.send||"server",o.post(n,t,q).then(function(t){e.notify(u.CardsJoinRequestStatus,t)})}function S(t){var n=U+"cards/requests/"+t;o["delete"](n,q).then(function(n){n.status&&(n.response.id=t),e.notify(u.CardsJoinRequestCancelStatus,n)})}function I(){var t=U+"cards/requests";o.get(t,null,q).then(function(t){e.notify(u.CardsActiveJoinRequestsStatus,t)})}function A(t){if(!t||!t.cardId)return void D("CardId param is mandatory!",t,3);var n,r=t.memberId;if(!r){if(n=O[t.cardId],!n)return void D("card not found for CardId=",t.cardId,3);for(var i,a=n.getMembers(),s=0,c=a.length;c>s;s++)if(i=a[s],i.getUserId()===q.getId()){r=i.getId();break}if(!r)return void D("current member not found for card=",n.toJSON(),3)}o["delete"](U+"cards/"+t.cardId+"/members/"+r,q).then(function(n){n.status&&(n.response.cardId=t.cardId,n.response.memberId=r,m()),e.notify(u.CardRemoveMemberStatus,n)})}function x(t){if(!t||!t.cardId)return void D("CardId param is mandatory!",t,3);var n=t.cardId,r=O[n];if(!r)return void D("Card with id="+n+" not found!",t,3);var i=y(r,t.fromTS,t.toTS);o.makeRequest({url:U+i.url,type:i.method},q).then(function(t){t.status&&(t.cardId=n),e.notify(u.CardActivityStatus,t)})}var T,k,R,O,D=i.dbg("CardsController",t.dbg),U=t.svcGlympse,P=t.pollCards||6e4,L=t.hasOwnProperty("cardsMode")?t.cardsMode:!!t.card,M=this,j=0,N=!1,q=t.account,G=!1,z=[];this.init=function(t){R=[],O={},k=t||[],j=k?k.length:0,N=!0,e.notify(u.CardsInitStart,k),q&&n()},this.notify=function(t,i){switch(t){case u.AccountLoginStatus:q=i.account,n(i);break;case u.AccountDeleteStatus:r();break;case u.CardInit:e.notify(t,i);break;case u.CardReady:e.notify(t,i);var a=O[i];-1===R.indexOf(a)&&(R.push(a),e.notify(u.CardAdded,a)),0===--j&&e.notify(u.CardsInitEnd,R);break;case u.CardUpdated:if(G)return void z.push(i);e.notify(t,i);break;default:D('Unknown msg: "'+t+'"',i)}return null},this.cmd=function(e,t){switch(e){case c.requestCards:return m();case d.getCards:return h();case c.request:return C(t);case c.removeMember:return A(t);case c.joinRequest:return E(t);case c.joinRequestCancel:return S(t);case c.getActiveJoinRequests:return I();case c.activity:return x(t);default:D("method not found",e)}}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/lib/rafUtils"),o=e("glympse-adapter/lib/ajax"),s=e("glympse-adapter/GlympseAdapterDefines"),u=s.MSG,c=s.CARDS.REQUESTS,d=s.CARDS.REQUESTS_LOCAL,l=s.CARDS.REQUEST_TYPES,p=(e("glympse-adapter/adapter/models/Account"),e("glympse-adapter/adapter/models/Card"));n.exports=r}),r("glympse-adapter/adapter/models/PublicGroup",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/rafUtils","glympse-adapter/lib/ajax","glympse-adapter/GlympseAdapterDefines"],function(e,t,n){"use strict";function r(e,t,n,r){function u(){return _?S?!0:(s.get(h+y,{next:C},t).then(p),!1):S?(o.setTimeout(function(){l(S)},200),!0):(s.get(h+b,w,t).then(l),!1)}function d(t,r,i,a){t.group=n,(r.length>0||i.length>0||a.length>0)&&(t.invitesAdded=r,t.invitesRemoved=i,t.invitesSwapped=a,e.notify(c.GroupStatus,t))}function l(t){_=!0;var n=[],r=[],i=[];t.status&&f(t,n,r,i),d(t,n,r,i),e.notify(c.GroupLoaded,t)}function p(e){var t=[],n=[],r=[];if(_=!0,e.status){var i=e.response;if("group"===i.type)f(e,t,n,r);else{C=i.events?i.events+1:0,E=e.time;var a=i.items;if(a){var o,s,u,c=[],l=[];for(o=0,s=a.length;s>o;o++)switch(u=a[o],u.type){case"invite":case"swap":case"leave":var p=u.member,h=l.indexOf(p);-1!==h&&(g(">> Cleanup outdated event: ",c[h]),l.splice(h,1),c.splice(h,1)),l.push(p),c.push(u)}var v,y;for(o=0,s=c.length;s>o;o++)switch(u=c[o],u.type){case"invite":case"swap":var b=u.invite;v=m(u.member),v?v.invite===b?g(">> Skip existing invite: ",b):(y={user:v.id,invOld:v.invite,invNew:b},g(">> Invite swap: ",y),r.push(y),v.invite=b):(g(">> ADD: ",b),t.push(b),I.push({id:u.member,invite:b}));break;case"leave":v=m(u.member),v&&(g(">> REMOVE: ",v.invite),n.push(v.invite),I.splice(I.indexOf(v),1))}}}}d(e,t,n,r)}function f(e,t,n,r){var i,a=e.response;C=a.events+1,E=e.time,a.branding;var o=a.members;if(o){var s,u,c=o.length;for(i=I.length-1;i>=0;i--){s=I[i];for(var d=c-1;d>=0;d--)if(u=o[d],s.id===u.id){if(s.invite!==u.invite){var l={user:s.id,invOld:s.invite,invNew:u.invite};g("** Invite swap: ",l),s.invite=u.invite,r.push(l)}s=null;break}s&&(g("** REMOVE: ",s.invite),n.push(s.invite),I.splice(i,1))}for(i=c-1;i>=0;i--)u=o[i],m(u.id)||u.invite&&(I.push(u),g("** ADD: ",u.invite),t.push(u.invite))}}function m(e){for(var t=I.length-1,n=null;t>=0;t--){var r=I[t];if(r.id===e){n=r;break}}return n}var g=a.dbg("PublicGroup",r.dbg),h=r.svcGlympse,v=encodeURIComponent(n),y="groups/"+v+"/events",b="groups/"+v,w={branding:!0},_=!1,C=0,E=0,S=i[n.toString().toLowerCase()],I=[];if(this.getInvites=function(){for(var e=I.length-1,t=[];e>=0;e--)t.push(I[e].invite);return t},this.getName=function(){return v},this.getUsers=function(){return I},this.request=function(){return u()},this.setData=function(e){return e?l({status:!0,response:e,time:Date.now()}):void 0},this.toString=function(){return"PublicGroup: "+JSON.stringify({name:v,numUsers:I.length,numInvites:this.getInvites().length})},this.toJSON=function(){return{name:v,users:I,invites:this.getInvites()}},r.demoDriversCount)for(var A=Math.max(0,Math.min(r.demoDriversCount,7)),x=i.demoshuttle.response.members,T=A-1;T>=0;T--)x.push({id:"DNA7-4HDZ-03WH"+T,invite:"demobot"+T})}var i,a=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/lib/rafUtils"),s=e("glympse-adapter/lib/ajax"),u=e("glympse-adapter/GlympseAdapterDefines"),c=u.MSG;i={bryanaroundseattle:{status:!0,response:{type:"group",id:119,events:1,members:[{id:"DNA7-4HDZ-03WHE",invite:"demobot0"}],"public":!0,name:"BryanTheRussel"},time:Date.now()},seattleteam:{status:!0,response:{type:"group",id:119,events:1,members:[{id:"DNA7-4HDZ-03WH0",invite:"demobot0"},{id:"DNA7-4HDZ-03WH1",invite:"demobot1"},{id:"DNA7-4HDZ-03WH2",invite:"demobot2"},{id:"DNA7-4HDZ-03WH3",invite:"demobot3"},{id:"DNA7-4HDZ-03WH4",invite:"demobot4"},{id:"DNA7-4HDZ-03WH5",invite:"demobot5"},{id:"DNA7-4HDZ-03WH6",invite:"demobot6"},{id:"DNA7-4HDZ-03WH7",invite:"demobot7"}],"public":!0,name:"SeattleTeam"},time:Date.now()},demoshuttle:{status:!0,response:{type:"group",id:119,events:1,members:[],"public":!0,name:"DemoShuttle",branding:{org_id:-999}},time:Date.now()}},n.exports=r}),r("glympse-adapter/adapter/PublicGroupController",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/rafUtils","glympse-adapter/lib/ajax","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/models/PublicGroup"],function(e,t,n){"use strict";function r(e,t){function n(e,n){var r,i;if("string"==typeof e?r=e:(r=e.name,i=e),!r)return g("ERROR no group name defined"),!1;if(r=r.toLowerCase(),w[r])return g('ERROR group "'+r+'" already loaded'),!1;if(n)return!0;var o=new u(E,b,r,t);if(w[r]=o,i)o.setData(i);else if(o.request())return!0;return C.push(o),m||(m=a.setInterval(l,y)),!0}function r(t){if(!t||!t.orgId){var n='"orgId" request param must be specified!';return g(n,t,3),void e.notify(c.OrgObjects,{status:!1,error:n})}var r=v[t.orgId];if(r)return void e.notify(c.OrgObjects,r);var i,a=h+"org/"+t.orgId+"/objects";t.objType&&(i={type:encodeURIComponent(t.objType)}),o.get(a,i,{account:b,useGlympseAuthHeader:!0}).then(function(t){e.notify(c.OrgObjects,t)})}function l(){var e=C.length;if(0===e&&m)return a.clearInterval(m),void(m=null);for(var t=0;e>t;t++)C[t].request()}function p(e){if(!b)return void g("[accountInitComplete] - authToken unavailable",e);for(var t=0,r=_.length;r>t;t++)n(_[t]);_=[]}function f(){b=null,m&&(a.clearInterval(m),m=null)}var m,g=i.dbg("PublicGroupController",t.dbg),h=t.svcEnRoute,v={},y=15e3,b=t.account,w={},_=[],C=[],E=this;this.notify=function(t,n){switch(t){case c.AccountLoginStatus:b=n.account,p(n);break;case c.AccountDeleteStatus:f();break;case c.GroupLoaded:case c.GroupStatus:e.notify(t,n);break;default:g('Unknown msg: "'+t+'"',n)}return null},this.cmd=function(t,i){switch(t){case d.addGroup:return b?n(i):(_.push(i),n(i,!0));case d.removeGroup:var o,u=(i&&i.name||"").toLowerCase(),c=u&&w.hasOwnProperty(u),l=c&&i.removeInvites||void 0;if(c){for(var p=C.length-1;p>=0;p--)if(C[p].getName()===u){C.splice(p,1);break}o=w[u].getInvites(),l&&a.setTimeout(function(){e.notify(s.MAP.REQUESTS.removeInvites,o.join(";"))},10),delete w[u],m&&0===C.length&&(a.clearInterval(m),m=null)}return{status:c,group:u,invites:o,removingInvites:l};case d.getGroups:var f,h=[];if(Array.isArray(i)){f=[];for(var p=i.length-1;p>=0;p--)i[p]&&f.push(i[p].toLowerCase())}for(var v in w)w.hasOwnProperty(v)&&(!i||"string"==typeof i&&i.toLowerCase()===v||f&&f.indexOf(v)>=0)&&h.push(w[v].toJSON());return h;case d.getOrgObjects:r(i);break;default:g('Unknown cmd: "'+t+'" - ',i)}},v[-999]={status:!0,response:[{hierarchy:[],org_id:-999,waypoints:t.demoWaypoints||[{name:"LAX Terminal #5",lat:33.9426841,lng:-118.4046578,stopTime:12e4},{name:"LAX Terminal #3",lat:33.9438901,lng:-118.4060479,stopTime:24e4},{name:"LAX Terminal #1",lat:33.9451076,lng:-118.4032515},{name:"Holiday Inn Los Angeles Gateway",lat:33.8507901,lng:-118.306608}],defaultStopTime:18e4,last_modified_by:0,group_name:"demoshuttle",access:"public",last_modified:1498017300352,created_time:1498017215788,creator_agent_id:0,_id:2,type:"route"}],time:Date.now()}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/lib/rafUtils"),o=e("glympse-adapter/lib/ajax"),s=e("glympse-adapter/GlympseAdapterDefines"),u=e("glympse-adapter/adapter/models/PublicGroup"),c=s.MSG,d=s.CORE.REQUESTS;s.CORE.REQUESTS_LOCAL;n.exports=r}),r("glympse-adapter/adapter/CoreController",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/ajax","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/models/Account","glympse-adapter/adapter/PublicGroupController"],function(e,t,n){"use strict";function r(e,t){function n(t){if(!t||!t.length)return f("ETA Info: no routes provided, nothing to calculate"),void e.notify(s.EtaInfo,{status:!0,result:[]});for(var n,r,i,o,u,c,d,l="maps/route?",p=[],h=0,v=t.length;v>h;h++){if(n=t[h],r=n.start,i=n.end,d={start:r.lat+","+r.lng,end:i.lat+","+i.lng,fields:"summary"},o=n.waypoints,o&&o.length){c=[];for(var y=0,b=o.length;b>y;y++)u=o[y],c.push(u.lat+","+u.lng);d.waypoints=c.join("|")}p.push({method:"GET",url:l+$.param(d)})}a.batch(m+"batch",p,g).then(function(t){for(var n,r,i=[],a=0,o=t.length;o>a;a++)n=(t[a]||{}).result,r=null,n.status&&(r=((n.response||{}).summary||{}).travel_time||0),i.push(r);f("> ETA results:",i),e.notify(s.EtaInfo,i)})}function r(t){if(!t)return f("invite's ETA Info: no invite-code provided"),void e.notify(s.InviteEta,{result:null});var n=m+"invites/"+t+"/eta";a.get(n,null,g).then(function(t){e.notify(s.InviteEta,t)})}var p,f=i.dbg("CoreController",t.dbg),m=t.svcGlympse,g=new d(this,t);this.init=function(){g.init()},this.notify=function(t,n){switch(t){case s.AccountLoginStatus:n.status&&p&&p.notify(t,n),e.notify(t,n);break;case s.AccountDeleteStatus:p&&p.notify(t,n),e.notify(t,n);break;case s.AccountCreateStatus:case s.UserNameUpdateStatus:case s.UserAvatarUpdateStatus:case s.UserInfoStatus:case s.CreateRequestStatus:case s.GroupLoaded:case s.GroupStatus:case s.OrgObjects:e.notify(t,n);break;case o.MAP.REQUESTS.removeInvites:var r=e.getService("map");if(r)return r.cmd(t,n);break;default:f('Unknown msg: "'+t+'"',n)}},this.cmd=function(e,i){switch(e){case c.hasAccount:return g.hasAccount();case u.addGroup:case u.getGroups:case u.removeGroup:return p||(p=new l(this,t)),p.cmd(e,i);case u.getOrgObjects:p.cmd(e,i);break;case c.accountCreate:g.create();break;case c.generateAuthToken:g.generateToken();break;case c.setUserName:g.setName(i);break;case c.setUserAvatar:g.setAvatar(i);break;case c.getUserInfo:g.getUserInfo(i);break;case c.createRequest:g.createRequest(i);break;case c.accountDelete:g["delete"]();break;case u.getEtaInfo:n(i);break;case u.getInviteEta:r(i)}},this.getAccount=function(){return g}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/lib/ajax"),o=e("glympse-adapter/GlympseAdapterDefines"),s=o.MSG,u=o.CORE.REQUESTS,c=o.CORE.REQUESTS_LOCAL,d=e("glympse-adapter/adapter/models/Account"),l=e("glympse-adapter/adapter/PublicGroupController");
n.exports=r}),r("glympse-adapter/adapter/models/GlympseInvite",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/lib/ajax","glympse-adapter/GlympseAdapterDefines"],function(e,t,n){"use strict";function r(e,t,n,r){function o(){e.notify(s.InviteInit,t),a.get(p,v,n).then(function(n){n.status?(g=!0,h.setData(n.response)):n.info?d={error:"load_failure",error_detail:"Failed "+f+" attempts"}:(d=n.response,d.id=i.normalizeInvite(t)),e.notify(s.InviteReady,h)})}var c,d,l=(i.dbg(u,r.dbg),r.svcGlympse),p=l+"invites/"+t,f=3,m=0,g=!1,h=this,v={no_count:!0,next:m},y=["first","last","next","properties","type"];this.isLoaded=function(){return g},this.getIdInvite=function(){return t},this.getError=function(){return d},this.getData=function(){return c},this.getReference=function(){return c&&c.reference},this.setData=function(e){c=e,c.location=null,i.mapProps(this,y,c)},this.setAccount=function(e){n=e},this.load=function(){return t&&n?(d=null,o(),!0):!1},this.toString=function(){return"["+u+"]: "+JSON.stringify(c)},this.toJSON=function(){return c||d}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/lib/ajax"),o=e("glympse-adapter/GlympseAdapterDefines"),s=o.MSG,u="GlympseInvite";n.exports=r}),r("glympse-adapter/adapter/GlympseLoader",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/models/Account","glympse-adapter/adapter/models/GlympseInvite"],function(e,t,n){"use strict";function r(e,t){function n(e){var n="[accountInitComplete] - ";return l?d?(u(n+"["+(t.isAnon?"ANON":"ACCT")+'] Token active. Loading Glympse invite "'+r+'"'),a?a.setAccount(d):a=new s(c,r,d,t),void(a.isLoaded()||a.load())):void u(n+"authToken unavailable",e):void u(n+"not initialized",e)}var r,a,u=i.dbg("GlympseLoader",t.dbg),c=this,d=t.account,l=!1;this.init=function(e){r=e,l=!0,d&&n(d)},this.notify=function(t,r){switch(t){case o.AccountLoginStatus:d=r.account,n(r);break;case o.AccountDeleteStatus:d=null,a&&a.setAccount(d);break;case o.InviteInit:e.notify(t,r);break;case o.InviteReady:e.notify(t,r);break;default:u('Unknown msg: "'+t+'"',r)}return null}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/GlympseAdapterDefines"),o=a.MSG,s=(e("glympse-adapter/adapter/models/Account"),e("glympse-adapter/adapter/models/GlympseInvite"));n.exports=r}),r("glympse-adapter/adapter/Client",["require","exports","module","glympse-adapter/lib/utils","oasis","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/ViewerMonitor","glympse-adapter/adapter/CardsController","glympse-adapter/adapter/CoreController","glympse-adapter/adapter/GlympseLoader","glympse-adapter/adapter/models/Account"],function(e,t,n){"use strict";function r(e,t,n,r,m){function g(){C(l.AdapterReady,{cards:U,tickets:P});var e=N.t,t=N.pg,n=N.twt,r=N.g;if(U.length>0||B)return void R.init(U);var i=N.object||{};return i.group||t?void O.cmd(p.addGroup,i.group||t):void((e||r||n)&&(q.t=e,q.twt=n,q.g=r,h(q)))}function h(e,t){G("loadMap!"),$.extend(q,e),t&&(F.viewer=t),F.viewer&&(q.t=q.t||"incorrect",L.run(),$(F.viewer).glympser(q))}function v(e){return e&&e.split(";")}function y(e,t){return function(n){return e.cmd(t,n)}}function b(e){return function(t){var n=e.cmd(t.id,t.args);return void 0!==n?n:!0}}function w(){C(l.Progress,{curr:Math.min(++J,Q),total:Q})}function _(e,t,r){!r&&N.hideUpdates||r&&N.hideEvents||n.notify(e,t)}function C(e,t){S(e,t),_(e,t,!0)}function E(e,t){G("**** Consumer Init **** q="+K.length),M=e,W=!0;for(var n=0,r=K.length;r>n;n++){var i=K[n];this.send(i.id,i.val)}K=[];var a=N.initialize;a&&a(t)}function S(e,t){W?M.send(e,t&&t.toJSON&&t.toJSON()||t):Z&&(0>Y||K.length<Y)&&K.push({id:e,val:t})}function I(){return X}function A(e){return L?L.getCurrentProperties(e):"NOT_INITIALIZED"}function x(e){return L?L.getCurrentValue(e.idProperty,e.idInvite):"NOT_INITIALIZED"}function T(e){G("setUserInfo",e)}var k,R,O,D,U,P,L,M,j=r&&r.app||{},N=r&&r.adapter||{},q=r&&r.viewer||{},G=i.dbg("Client",j.dbg),z={},F={dbg:j.dbg,viewer:m},H={},V={},J=0,Q=0,W=!1,K=[],Y=void 0!==N.hostQueueMaxSize?N.hostQueueMaxSize:-1,Z=0!==Y,B=N.cardsMode,X={},ee=!1,te=N.apiKey||"nXQ44D38OdVzEC34";N.apiKey=te,N.dbg=j.dbg||N.dbg,N.svcGlympse=N.svcGlympse||"https://api."+(N.sandbox?"sandbox.":"")+"glympse.com/v2/",N.svcEnRoute=N.svcEnRoute||"https://"+(N.sandbox?"s-":"")+"api.enterprise.glympse.com/api/v1/",q.apiKey=te,q.services=N.svcGlympse,this.getService=function(e){return z[e]},this.init=function(n){var d=N.card,p=N.t,f={consumers:{}},m={},g={},h=i.cleanInvites;U=d?h([d]):[],P=h(v(p)),m.setUserInfo=T,$.extend(n,{invitesCard:U,invitesGlympse:P}),O=new c(this,N),R=new u(this,N),L=new s(this,F);var _=[{id:"MAP",targ:L},{id:"CARDS",targ:R},{id:"CORE",targ:O}],k={map:{},cards:{},core:{},app:{}};k.app.getConfig=I,k.app.sendOasisMessage=S,k.map[s.GetInviteProperties]=A,k.map[s.GetInviteProperty]=x;for(var D=0,M=_.length;M>D;D++){var j,H=_[D],V=H.id.toLowerCase(),W=[];z[V]=H.targ,g[V]=b(H.targ);var Y=k[V];for(j in Y)W.push(j),e[V][j]=Y[j];Y=o[H.id].REQUESTS;for(j in Y)W.push(j),e[V][j]=y(H.targ,j);Y=o[H.id].REQUESTS_LOCAL;for(j in Y)e[V][j]=y(H.targ,j);n[V]=W}var Z=N.interfaces;if(Z){g.ext=function(e){return Z[e.id](e.args)};var ee=[];for(j in Z)ee.push(j),e.ext[j]=Z[j];n.ext=ee}var te={getConfig:I,sendOasisMessage:S};g.app=function(e){return te[e.id](e.args)},n.app=[];for(j in te)n.app.push(j),e.app[j]=te[j];var ne=i.generateClone(q);delete ne.apiKey,X={viewer:ne,published:i.generateClone(r.published)},K.push({id:"Connected",val:$.extend({},n,{cfg:X})}),f.consumers[o.PORT]=a.Consumer.extend({initialize:E,events:m,requests:g}),t.connect(f);var re=N.object||{},ie={isCard:null!==d||B,t:P,pg:re.group||v(N.pg),twt:v(N.twt),g:v(N.g)};J=0,Q=U.length>0?7:P.length>0?3:0,C(l.AdapterInit,ie),w(),G("Init core.."),O.init()},this.loadViewer=function(e,t){h(e,t)},this.infoUpdate=function(e,t,n,r,a){t=i.normalizeInvite(t);var o,s,u=V[t]||[],c=u.length;for(s=c?c-1:0;s>=0;s--)o={id:e,invite:t,owner:n,card:u[s],t:r,val:a},_(f,o,!1),S(f,o)},this.notify=function(e,t){var n,r,i,a;switch(e){case l.CardInit:case l.CardReady:case l.CardsInitStart:case l.InviteInit:case l.ViewerInit:w(),C(e,t);break;case l.ViewerReady:w(),S(e,!0),_(e,t,!0);break;case l.ViewerZoomChanged:case l.CardsInitEnd:C(e,t);break;case l.CardUpdated:switch(t.action){case"invite_code_found":case"member_started_sharing":var o=t.invite;V[o]||(V[o]=[]),i=t.card.getId(),V[o].indexOf(i)<0&&V[o].push(i);break;case"member_stopped_sharing":this.infoUpdate(d.InviteEnd,t.invite,t.userId,t.t,t.t),this.infoUpdate(d.InviteCompleted,t.invite,t.userId,t.t,!0);var s=V[t.invite];s&&(r=s.indexOf(t.card.getId()),r>=0&&s.splice(r,1))}C(e,t);break;case l.InviteError:t.data.invite.toJSON&&(t.data.invite=t.data.invite.toJSON()),C(e,t);break;case l.InviteClicked:C(e,t);break;case l.InviteReady:if(!t.isLoaded()){var u=t.getError();return G("Invite error state",u),C(l.InviteError,t),null}C(e,t),i=t.getReference(),i?U.indexOf(i)<0&&(H[i]=t.getIdInvite(),Q+=5,U.push(i),w()):(Q+=2,w(),q.t=t.getIdInvite(),h(q));break;case l.CardAdded:C(e,t);break;case l.CardRemoved:i=t.getId();for(var c in V){var p=V[c];p&&(r=p.indexOf(i),r>=0&&p.splice(r,1))}C(e,t);break;case l.DataUpdate:case l.InviteAdded:case l.InviteRemoved:if(s||B)for(a=V[t.id]||[],n=a.length-1;n>=0;n--)C(e,$.extend({card:a[n]},t));else C(e,t);break;case l.AccountLoginStatus:t.status&&(k=O.getAccount(),N.account=k,q.authToken=k.getToken(),t.account=k,D&&D.notify(e,t),R&&R.notify(e,t),delete t.account),C(e,t),!ee&&t.status&&(ee=!0,g());break;case l.AccountDeleteStatus:D&&D.notify(e,t),R&&R.notify(e,t),C(e,t);break;case l.AccountCreateStatus:case l.CreateRequestStatus:case l.UserNameUpdateStatus:case l.UserAvatarUpdateStatus:case l.UserInfoStatus:case l.CardsJoinRequestStatus:case l.CardsJoinRequestCancelStatus:case l.CardActivityStatus:case l.CardsActiveJoinRequestsStatus:case l.CardRemoveMemberStatus:case l.CardsLocationRequestStatus:case l.CardsRequestStatus:C(e,t);break;case l.GroupLoaded:case l.GroupStatus:case l.OrgObjects:case l.EtaInfo:case l.InviteEta:C(e,t);break;default:G('notify(): unknown msg: "'+e+'"',t)}return null}}var i=e("glympse-adapter/lib/utils"),a=e("oasis"),o=e("glympse-adapter/GlympseAdapterDefines"),s=e("glympse-adapter/adapter/ViewerMonitor"),u=e("glympse-adapter/adapter/CardsController"),c=e("glympse-adapter/adapter/CoreController"),d=(e("glympse-adapter/adapter/GlympseLoader"),e("glympse-adapter/adapter/models/Account"),o.STATE),l=o.MSG,p=o.CORE.REQUESTS,f=l.StateUpdate;n.exports=r}),r("glympse-adapter/adapter/Host",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/GlympseAdapterDefines","oasis"],function(e,t,n){"use strict";function r(e,t,n){function r(e,t){d=e,p&&p(t)}function s(t){g('clientConnected: "'+t.id+'" v('+t.version+")");for(var n=["map","card","core","ext","app"],r=0,i=n.length;i>r;r++){var a=n[r],o=t&&t[a];if(o)for(var s=0,u=o.length;u>s;s++){var d=o[s];e[a][d]=c(a,d)}}f&&f(t)}function u(e){switch(g("[request.getInfo]",e),e){default:return{error:'Unknown infoType "'+e+'"'}}}function c(e,t){var n={id:t,args:null};return function(t){return n.args=t,d.request(e,n)}}var d,l,p,f,m=n&&n.app||{},g=(n&&n.adapter||{},i.dbg("Host",m.dbg));this.init=function(e){p=e.initialize,f=e.connect;var n=e.events||{};n.Connected=s;var i=a.PORT,c={url:e.url,type:"html",capabilities:[i],services:{},sandbox:e.sandbox};return c.services[i]=o.Service.extend({initialize:r,events:n,requests:{getInfo:u}}),l=t.createSandbox(c),l.el}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-adapter/GlympseAdapterDefines"),o=e("oasis");n.exports=r}),r("glympse-adapter/GlympseAdapter",["require","exports","module","UUID","kamino","MessageChannel","glympse-adapter/lib/utils","oasis","glympse-adapter/VersionInfo","glympse-adapter/adapter/Client","glympse-adapter/adapter/Host","glympse-adapter/lib/ajax"],function(e,t,n){"use strict";function r(e,t){function n(){var e=$.Deferred();if($.fn.glympser)v("glympser loader is already included in the page - use existing."),e.resolve();else{var t=g.loaderPath||["//","sandbox"===g.loaderEnvironment||g.sandbox?"s-":"","viewer.content.glympse.com/components/glympse-viewer/",g.loaderVersion||"stable","/jquery.glympser.min.js"].join("");v("loading glympser loader from",t),$.ajax({dataType:"script",cache:!0,url:t}).done(function(){v(".. loaded glympser loader!"),e.resolve()}).fail(function(){v("Failed to load Loader script:",arguments,3),e.reject()})}return e}var r,d,l,p,f="GlympseAdapter",m=t&&t.app||{},g=t&&t.adapter||{},h=t&&t.viewer||{},v=i.dbg(f,m.dbg),y=this,b=null,w=o.version;g.appName&&g.appVersion&&!h.appName&&!h.appVersion&&(h.appName=g.appName,h.appVersion=g.appVersion),g.appName=g.appName||f,g.appVersion=g.appVersion||w,c.requestHeaders={"X-GlympseAgent":"app="+g.appName+"&ver="+g.appVersion+"&comp="+f+"&comp_ver="+w},this.app={},this.cards={},this.core={},this.ext={},this.map={},this.loadViewer=function(e,t){return b?void b.done(function(){r.loadViewer(e,t)}):void v("adapter must be initialized in client mode first",null,3)},this.host=function(e){return d||r?l:(d=new u(this,p,t),l=d.init(e))},this.client=function(i){d||r||(b=n(),b.done(function(){r=new s(y,p,e,t,i&&i[0]),r.init({id:o.id,version:o.version})}))},p=new a,p.autoInitializeSandbox(),p.configure("allowSameOrigin",!0)}e("UUID"),e("kamino"),e("MessageChannel");var i=e("glympse-adapter/lib/utils"),a=e("oasis"),o=e("glympse-adapter/VersionInfo"),s=e("glympse-adapter/adapter/Client"),u=e("glympse-adapter/adapter/Host"),c=e("glympse-adapter/lib/ajax");window.Oasis||(window.Oasis=a),function(e){var t=e.glympse||{};t.GlympseAdapter||(t.GlympseAdapter=r),e.glympse=t}(window),n.exports=r}),r("glympse-journey-core/Defines",["require","exports","module"],function(e,t,n){"use strict";var r={strings:{},CMD:{InitUi:"InitUi",SendEvent:"SendEvent",SendFeedback:"SendFeedback",UpdateAuth:"UpdateAuth"},MSG:{TokenUpdate:"TokenUpdate",EventSubmitted:"EventSubmitted",FeedbackSubmitted:"FeedbackSubmitted",ForcePhase:"ForcePhase",ForceAbort:"ForceAbort",ComponentLoaded:"ComponentLoaded",StartQueryEta:"StartQueryEta",StopQueryEta:"StopQueryEta"},STATE:{ArrivalRange:"ArrivalRange",FutureTime:"future",LastUpdate:"LastUpdate",OrderInfo:"order_id",PromiseTime:"promise",StoreLocation:"base_location",Visibility:"visibility",DriverId:"driver_id",Duration:"duration",ApptFrom:"appt_from",ApptTo:"appt_to",ApptTimezone:"appt_tz"},PHASE:{None:"-",Initial:"initial",Pre:"pre",Eta:"eta",Live:"live",Arrived:"arrived",Feedback:"feedback",Completed:"completed",NotSet:"notset",Aborted:"not_completed",Cancelled:"cancelled"},ResponseCode:{success:0,errorLoading:1,noStatus:2,noData:3,noToken:4,throttled:5,unknown:6,noResponse:999}};window.glympse||(window.glympse={}),window.glympse.JourneyCoreDefines||(window.glympse.JourneyCoreDefines=r),n.exports=r}),r("glympse-journey-core/models/AppResponse",["require","exports","module","glympse-journey-core/Defines"],function(e,t,n){"use strict";function r(e){this.loaded=e&&e.loaded||!1,this.code=e&&e.code||i.noResponse,this.info=e&&e.info||"no response",this.clone=function(){return new r(this)}}var i=e("glympse-journey-core/Defines").ResponseCode;n.exports=r}),r("glympse-journey-core/models/providers/enroute",["require","exports","module","glympse-adapter/lib/utils","glympse-journey-core/Defines","glympse-journey-core/models/AppResponse"],function(e,t,n){"use strict";function r(e,t){function n(){v||(v=i.getCookie("access_token"))}function a(e){p(),f("action",{action:e},s.EventSubmitted)}function l(e){var n,r,i=0,a=[];if(e.info)for(n=0,r=e.info.length;r>n;n++,i++)a.push({_id:i,value:e.info[n]});if(e.options)for(n=0,r=e.options.length;r>n;n++,i++)a.push({_id:i,value:e.options[n]});p();var o={survey_id:t.surveyId,uid:v,rating:e.rating,comment:e.comments};a.length>0&&(o.items=a),f("feedback",o,s.FeedbackSubmitted)}function p(){v||(n(),v||(v=void 0))}function f(n,r,a){$.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Glympse "+v)},url:g.replace("$INVITE",i.normalizeInvite(t.idInvite)),data:JSON.stringify({type:n,data:r}),processData:!1}).done(function(e){m(e,a)}).fail(function(t,n){e.notify(a,new d({code:u.errorLoading,info:"Error loading: "+g}))})}function m(t,n){var r=new d({loaded:!0});if(t){var i=t[c];r.code=u.success,r.info=i,i?"ok"!==i&&(r.code=u.unknown):(r.code=u.missingStatus,r.info="No status_code")}e.notify(n,r)}var g=t.baseUrl,h=i.dbg("providers."+r.id,t.dbg),v=t.authToken;this.cmd=function(e,t){switch(e){case o.UpdateAuth:n();break;case o.SendEvent:a(t);break;case o.SendFeedback:l(t);break;default:h('Unknown cmd "'+e+'"',t)}},this.notify=function(e,t){switch(e){default:h('Unknown msg "'+e+'"',t)}}}var i=e("glympse-adapter/lib/utils"),a=e("glympse-journey-core/Defines"),o=a.CMD,s=a.MSG,u=a.ResponseCode,c="result",d=e("glympse-journey-core/models/AppResponse");r.id="enroute",n.exports=r}),r("JourneyCore",["require","exports","module","glympse-adapter/GlympseAdapter","glympse-adapter/GlympseAdapterDefines","glympse-adapter/lib/utils","glympse-journey-core/Defines","glympse-journey-core/models/providers/enroute"],function(e,t,n){"use strict";function r(e,t){function n(e,t,n){return{id:e,t:t,val:n}}function r(e,t){H={phase:e,t:t}}function a(e){if(ee){var t=e.id,n=ee[t];if(n&&n.length>0&&t!==g.Phase&&n.indexOf(H.phase)<0)return te[t]=e,!0}return te[t]=void 0,!1}function s(e,t,r){var i=n(e,t,r);a(i)||ie.cmd(j,i)}function h(){if(H.phase===f.Live&&G>0){G--;var e=R.map.getInvites()[0].getInvite().location;if(console.log("******** Checking for location!! --> ",e),!e)return console.log("******** NO LOC... retrying in "+z+"ms (tries left="+G+")"),void setTimeout(h,z);G=0,console.log("******** LOC success... pushing phase")}s(g.Phase,H&&H.t||0,H);for(var t in te){var n=te[t];n&&!a(n)&&ie.cmd(j,n)}v()}function v(){if(O&&(clearTimeout(O),O=0),F&&F.eta!==k&&null!==F.eta){var e=R.map.getInvites()[0],t=1e3*e.getEtaEstimate(),n=(new Date).getTime();isNaN(t)||s(g.Eta,n,{eta:t>0?t:0,eta_ts:n}),Q>0&&(O=setTimeout(v,Q))}}function y(e){Y>=e||(Y=e,s(p.LastUpdate,e,e))}function b(e){var t=e.id,n=e.val,i=e.t,a=Y;switch(t){case g.Eta:return!n||n.type!==p.PromiseTime&&n.type!==p.FutureTime?(F=n,void v()):void s(n.type,i,n);case g.Phase:return r(X[n]||n,i),h(),void y(i);case g.Destination:a=i>a?i:a;break;case g.InviteStart:a=i>a?i:a,re=Number(n);break;case g.Name:return n=P.agentFirstNameOnly?n&&n.split(" ")[0]:n,void s(t,i,n);case g.Avatar:return void s(t,i,n);case g.Expired:var o=P.mapExpiredToPhase,u=H.phase;if(n&&o&&u!==f.Cancelled&&u!==f.Completed)return r(o,i),void h()}s(t,i,n),y(a)}function w(e){for(var t,n=Y,r=-1,i=-1,a=null,o=0,u=e.length;u>o;o++){var c=e[o],d=c.n,l=c.v,f=c.t;switch(d){case p.Visibility:n=f>n?f:n,s(d,f,l);break;case p.StoreLocation:ne||(ne=!0,s(d,f,l));break;case p.OrderInfo:P.idOrder=l,s(d,f,l);break;case p.ApptFrom:r=l;break;case p.ApptTo:i=l;break;case p.ApptTimezone:var m=l.split(":");a=60*Number(m[0])+Number(m[1]);break;case p.Duration:s(d,f,l);break;default:t||(t=[]),t.push(c)}}if(r>0&&i>0){var g=new Date,h=null===a||isNaN(a)?0:60*(g.getTimezoneOffset()+a)*1e3;s(p.ArrivalRange,g.getTime(),{from:r+h,to:i+h})}y(n),t&&ie.cmd(M,t)}function _(){!K||Z>B||(console.log("JOURNEY_READY"),B=-1)}function C(e){V||(V=!0,U=e||J,S())}function E(){V=!1,D&&(clearTimeout(D),D=0)}function S(){R.core.getInviteEta(R.map.getInvites()[0].getInvite().id)}function I(e,t){ie.cmd(e,t),V&&(D=setTimeout(S,U))}function A(){t.adapter.anon=!0,t.adapter.initialize=x,R=new i(q,t),R.client($(P.elementViewer))}function x(){}function T(e){return g[e]}var k,R,O,D,U,P=t.journey||{},L=o.dbg(c,P.dbg),M=m.DataUpdate,j=m.StateUpdate,N="[ERROR]: ",q=this,G=P.numNoLocChecks||0,z=1e3,F=k,H=null,V=!1,J=3e4,Q=P.etaUpdateInterval||0,W=!1,K=!1,Y=0,Z=1,B=0,X=P.mapPhases||{},ee=P.phaseStateFilter,te={},ne=!1,re=0,ie=e;return this.toString=function(){return c},this.notify=function(e,t){switch(e){case j:W&&b(t);break;case M:W&&w(t&&t.data,!1);break;case m.Progress:ie.cmd(e,t.curr/t.total);break;case m.ViewerReady:W=!0;var i=R.map.getInviteProperties(),a=[],o=Object.keys(g).map(T),s=g.Phase,c=i[s];o.splice(o.indexOf(s),1),c&&b(n(s,c.t,c.v)),H||(re=re||(new Date).getTime(),r(P.defaultPhase||f.Live,re),h());for(var p in i)p!==s&&(c=i[p],o.indexOf(p)>=0?void 0!==c.v&&b(n(p,c.t,c.v)):a.push($.extend(i[p],{n:p})));w(a,!0),setTimeout(function(){B+=ie.cmd(d.InitUi,{t:re,providers:u,adapter:R})||0,_()},400);break;case l.ForcePhase:H=t,h();break;case l.ForceAbort:r(f.Aborted,(new Date).getTime()),h();break;case l.ComponentLoaded:B>=0&&(B++,_());break;case m.ViewerInit:return ie.cmd(e,{adapter:R,args:t});case m.AdapterInit:case m.AdapterReady:case m.InviteInit:case m.InviteReady:case m.InviteAdded:return ie.cmd(e,t);case l.StartQueryEta:C(t);break;case l.StopQueryEta:E();break;case m.InviteEta:I(e,t);break;default:return L('notify(): unhandled msg: "'+e+'"',t),ie.cmd(e,t)}return null},t?t.adapter?t.journey?t.viewer?ie?(P.snapshotMode&&(K=!0,t.viewer.screenOnly=!0,console.log("SNAPSHOT_FINALIZE:JOURNEY_READY")),Z=ie.init(this,K)||0,void setTimeout(A,100)):void console.log(N+"viewManager not defined!"):void console.log(N+'Missing "viewer" config!'):void console.log(N+'Missing "journey" config!'):void console.log(N+'Missing "adapter" config!'):void console.log(N+"Missing config!")}var i=e("glympse-adapter/GlympseAdapter"),a=e("glympse-adapter/GlympseAdapterDefines"),o=e("glympse-adapter/lib/utils"),s=e("glympse-journey-core/Defines"),u=[e("glympse-journey-core/models/providers/enroute")],c="JourneyCore",d=s.CMD,l=s.MSG,p=s.STATE,f=s.PHASE,m=a.MSG,g=a.STATE;console.log(c+" v(1.10.0)"),n.exports=r}),n(["JourneyCore"]),t("JourneyCore")});
//# sourceMappingURL=glympse-journey-core-1.10.0.min.js.map